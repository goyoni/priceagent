"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[425],{3425:function(e,t,r){r.d(t,{T:function(){return l}});var n=r(7437),a=r(7850),s=r(2265),c=r(3448);function i(e){let{isOpen:t,onClose:r,title:a,children:i,footer:o,className:l}=e;return((0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,r]),t)?(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:r,children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/70"}),(0,n.jsxs)("div",{className:(0,c.cn)("relative bg-surface rounded-xl max-w-2xl w-[90%] max-h-[80vh] overflow-hidden","shadow-2xl",l),onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-surface-hover",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:a}),(0,n.jsx)("button",{onClick:r,className:"text-secondary hover:text-gray-800 text-2xl leading-none",children:"\xd7"})]}),(0,n.jsx)("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:i}),o&&(0,n.jsx)("div",{className:"flex justify-end gap-3 px-5 py-4 border-t border-surface-hover",children:o})]})]}):null}var o=r(6334);function l(){let{isModalOpen:e,closeModal:t,drafts:r,sentIndices:s,updateDraftMessage:l,updateDraftPhone:d,markAsSent:u,isGenerating:h,error:f}=(0,a.z)(),g=e=>{let t=r[e];window.open(t.wa_link,"_blank"),u(e)},y=async e=>{let t=r[e];await navigator.clipboard.writeText(t.wa_link)};return(0,n.jsx)(i,{isOpen:e,onClose:t,title:"Review Negotiation Messages",footer:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.z,{variant:"success",onClick:()=>{r.forEach((e,t)=>{s.has(t)||setTimeout(()=>g(t),500*t)})},children:"Send All via WhatsApp"}),(0,n.jsx)(o.z,{variant:"secondary",onClick:t,children:"Cancel"})]}),children:h?(0,n.jsx)("p",{className:"text-secondary text-center py-8",children:"Generating drafts..."}):f?(0,n.jsx)("p",{className:"text-error text-center py-8",children:f}):(0,n.jsx)("div",{className:"space-y-4",children:r.map((e,t)=>(0,n.jsxs)("div",{className:(0,c.cn)("bg-background rounded-lg p-4",s.has(t)&&"opacity-60 border-2 border-success"),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:!0,readOnly:!0,className:"w-4 h-4"}),(0,n.jsx)("strong",{className:"text-primary",children:e.seller_name})]}),(0,n.jsxs)("p",{className:"text-sm text-secondary mb-3",children:["Product: ",e.product_name]}),(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)("label",{className:"block text-xs text-secondary mb-1",children:"Phone Number:"}),(0,n.jsx)("input",{type:"text",value:e.phone_number,onChange:e=>d(t,e.target.value),className:"w-48 px-3 py-1.5 bg-surface border border-surface-hover rounded text-gray-800 text-sm focus:outline-none focus:border-primary"})]}),(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)("label",{className:"block text-xs text-secondary mb-1",children:"Message:"}),(0,n.jsx)("textarea",{value:e.message,onChange:e=>l(t,e.target.value),className:"w-full min-h-[80px] px-3 py-2 bg-surface border border-surface-hover rounded text-gray-800 text-sm resize-y focus:outline-none focus:border-primary"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(o.z,{variant:"success",size:"sm",onClick:()=>g(t),disabled:s.has(t),children:s.has(t)?"âœ“ Opened":"\uD83D\uDCF1 Send via WhatsApp"}),(0,n.jsx)(o.z,{variant:"secondary",size:"sm",onClick:()=>y(t),children:"\uD83D\uDD17 Copy Link"})]})]},t))})})}},6334:function(e,t,r){r.d(t,{z:function(){return o}});var n=r(7437),a=r(3448),s=r(2265);let c={primary:"bg-cyan-600 text-white hover:bg-cyan-500",secondary:"bg-slate-700 text-slate-300 hover:bg-slate-600",success:"bg-emerald-600 text-white hover:bg-emerald-500",danger:"bg-red-600 text-white hover:bg-red-500",ghost:"bg-transparent text-slate-300 hover:bg-slate-700"},i={sm:"px-2 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},o=(0,s.forwardRef)((e,t)=>{let{variant:r="primary",size:s="md",className:o,disabled:l,...d}=e;return(0,n.jsx)("button",{ref:t,className:(0,a.cn)("inline-flex items-center justify-center rounded font-medium transition-colors","focus:outline-none focus:ring-2 focus:ring-cyan-500/50","disabled:opacity-50 disabled:cursor-not-allowed",c[r],i[s],o),disabled:l,...d})});o.displayName="Button"},1837:function(e,t,r){r.d(t,{h:function(){return a}});class n{getAuthToken(){return localStorage.getItem("dashboard_auth_token")}async fetch(e,t){let r={"Content-Type":"application/json",...null==t?void 0:t.headers},n=this.getAuthToken();n&&(r["X-Dashboard-Auth"]=n);let a=await fetch("".concat(this.baseUrl).concat(e),{...t,headers:r});if(!a.ok)throw Error("API error: ".concat(a.status," ").concat(a.statusText));return a.json()}async getTraces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return(await this.fetch("/traces/?limit=".concat(e))).traces}async getTrace(e){return this.fetch("/traces/".concat(e))}async deleteTrace(e){await this.fetch("/traces/".concat(e),{method:"DELETE"})}async runQuery(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"research";return this.fetch("/agent/run",{method:"POST",body:JSON.stringify({query:e,agent:t})})}async generateDrafts(e){return this.fetch("/agent/generate-drafts",{method:"POST",body:JSON.stringify(e)})}async lookupContacts(e){return(await this.fetch("/api/sellers/contacts",{method:"POST",body:JSON.stringify({domains:e})})).contacts}async getSellers(){return(await this.fetch("/api/sellers/")).sellers}async runDiscovery(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IL";return this.fetch("/agent/run",{method:"POST",body:JSON.stringify({query:e,agent:"discovery",country:t})})}async runDiscoveryRefinement(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IL",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return this.fetch("/agent/run",{method:"POST",body:JSON.stringify({query:e,agent:"discovery",country:t,conversation_history:r,session_id:n,parent_trace_id:a})})}async getCountry(){return this.fetch("/api/geo/country")}async startPriceSearch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IL";return this.fetch("/api/shopping-list/search-prices",{method:"POST",body:JSON.stringify({items:e,country:t})})}async getSearchStatus(e){return this.fetch("/api/shopping-list/search-status/".concat(e))}async getCategories(e){let t={};return e&&(t["X-Dashboard-Auth"]=e),(await this.fetch("/api/criteria/",{headers:t})).categories}async getCategoryCriteria(e,t){let r={};return t&&(r["X-Dashboard-Auth"]=t),this.fetch("/api/criteria/".concat(e),{headers:r})}async updateCategoryCriteria(e,t,r){let n={};return r&&(n["X-Dashboard-Auth"]=r),this.fetch("/api/criteria/".concat(e),{method:"PUT",headers:n,body:JSON.stringify({criteria:t})})}async createCategory(e,t,r){let n={};return r&&(n["X-Dashboard-Auth"]=r),this.fetch("/api/criteria/".concat(e),{method:"POST",headers:n,body:JSON.stringify({criteria:t})})}async deleteCategory(e,t){let r={};return t&&(r["X-Dashboard-Auth"]=t),this.fetch("/api/criteria/".concat(e),{method:"DELETE",headers:r})}constructor(e=""){this.baseUrl=e}}let a=new n},3448:function(e,t,r){r.d(t,{$G:function(){return l},LU:function(){return i},T4:function(){return o},cn:function(){return s},kU:function(){return d},p6:function(){return c}});var n=r(1994),a=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}function c(e){return e?new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function i(e){return e<1e3?"".concat(e,"ms"):"".concat((e/1e3).toFixed(1),"s")}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ILS";return"".concat(e.toLocaleString()," ").concat(t)}function l(e,t){return e?e.length<=t?e:e.slice(0,t-3)+"...":""}function d(e,t){let r=e.replace(/[^0-9]/g,""),n="https://wa.me/".concat(r);return t&&(n+="?text=".concat(encodeURIComponent(t))),n}},7850:function(e,t,r){r.d(t,{z:function(){return c}});var n=r(9625),a=r(1837),s=r(3448);let c=(0,n.Ue)((e,t)=>({isModalOpen:!1,isGenerating:!1,drafts:[],sentIndices:new Set,error:null,openModal:()=>e({isModalOpen:!0}),closeModal:()=>e({isModalOpen:!1,drafts:[],sentIndices:new Set,error:null}),updateDraftMessage:(t,r)=>e(e=>{let n=[...e.drafts];return n[t]&&(n[t]={...n[t],message:r,wa_link:(0,s.kU)(n[t].phone_number,r)}),{drafts:n}}),updateDraftPhone:(t,r)=>e(e=>{let n=[...e.drafts];return n[t]&&(n[t]={...n[t],phone_number:r,wa_link:(0,s.kU)(r,n[t].message)}),{drafts:n}}),markAsSent:t=>e(e=>({sentIndices:new Set([...e.sentIndices,t])})),clearDrafts:()=>e({drafts:[],sentIndices:new Set,error:null}),generateDrafts:async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"he";e({isGenerating:!0,error:null});try{let n=await a.h.generateDrafts({sellers:t,language:r});e({drafts:n.drafts,isGenerating:!1,isModalOpen:!0})}catch(t){e({error:t instanceof Error?t.message:"Failed to generate drafts",isGenerating:!1})}}}))}}]);