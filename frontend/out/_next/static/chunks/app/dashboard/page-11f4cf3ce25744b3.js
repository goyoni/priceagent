(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{710:function(e,t,s){Promise.resolve().then(s.bind(s,434))},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return r.a}});var a=s(2972),r=s.n(a)},434:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return F}});var a=s(7437),r=s(2265),l=s(7648),n=s(9625),c=s(1837);let i=(0,n.Ue)((e,t)=>({traces:[],selectedTraceId:null,selectedTrace:null,connectionStatus:"connecting",isLoading:!1,error:null,setTraces:t=>e({traces:t||[]}),selectTrace:s=>{e({selectedTraceId:s}),s?t().fetchTraceDetail(s):e({selectedTrace:null})},setSelectedTraceDetail:t=>e({selectedTrace:t}),updateTrace:(t,s)=>e(e=>{var a;return{traces:(e.traces||[]).map(e=>e.id===t?{...e,...s}:e),selectedTrace:(null===(a=e.selectedTrace)||void 0===a?void 0:a.id)===t?{...e.selectedTrace,...s}:e.selectedTrace}}),addTrace:t=>e(e=>({traces:[t,...e.traces||[]].slice(0,50)})),deleteTrace:async t=>{try{await c.h.deleteTrace(t),e(e=>{var s;return{traces:(e.traces||[]).filter(e=>e.id!==t),selectedTraceId:e.selectedTraceId===t?null:e.selectedTraceId,selectedTrace:(null===(s=e.selectedTrace)||void 0===s?void 0:s.id)===t?null:e.selectedTrace}})}catch(e){console.error("Failed to delete trace:",e)}},setConnectionStatus:t=>e({connectionStatus:t}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),fetchTraces:async()=>{e({isLoading:!0,error:null});try{let t=await c.h.getTraces();e({traces:t||[],isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch traces",isLoading:!1})}},fetchTraceDetail:async t=>{e({isLoading:!0,error:null});try{let s=await c.h.getTrace(t);e({selectedTrace:s,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch trace",isLoading:!1})}}}));var o=s(3448);function d(){let e={connecting:{color:"bg-warning",text:"Connecting..."},connected:{color:"bg-success",text:"Connected"},disconnected:{color:"bg-error",text:"Disconnected"}}[i(e=>e.connectionStatus)];return(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-secondary",children:[(0,a.jsx)("span",{className:(0,o.cn)("w-2 h-2 rounded-full animate-pulse",e.color)}),(0,a.jsx)("span",{children:e.text})]})}function x(){return(0,a.jsxs)("header",{className:"h-14 bg-slate-800 border-b border-slate-700 px-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-white",children:"Agent Dashboard"}),(0,a.jsxs)("nav",{className:"flex items-center gap-4",children:[(0,a.jsx)(l.default,{href:"/sellers",className:"text-sm text-slate-400 hover:text-white transition-colors",children:"Sellers DB"}),(0,a.jsx)(l.default,{href:"/criteria",className:"text-sm text-slate-400 hover:text-white transition-colors",children:"Criteria"})]})]}),(0,a.jsx)(d,{})]})}var m=s(9376);let u={default:"bg-surface text-secondary",success:"bg-success/20 text-success",warning:"bg-warning/20 text-warning",error:"bg-error/20 text-error",info:"bg-primary/20 text-primary",secondary:"bg-secondary/20 text-secondary",primary:"bg-primary/30 text-primary"};function p(e){let{variant:t="default",children:s,className:r}=e;return(0,a.jsx)("span",{className:(0,o.cn)("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",u[t],r),children:s})}function h(e){var t,s;let{trace:r,isSelected:l,onClick:n,onDelete:c,childCount:i,isChild:d}=e,x="completed"===r.status?"success":"error"===r.status?"error":"warning",m=(null===(t=r.spans)||void 0===t?void 0:t.filter(e=>"running"===e.status))||[];return(0,a.jsxs)("div",{"data-testid":"trace-item",className:(0,o.cn)("p-3 rounded-lg cursor-pointer transition-colors relative group","hover:bg-slate-700",l?"bg-slate-700 border border-cyan-500/50":"bg-slate-800","running"===r.status&&"border-l-2 border-l-amber-500",d&&"py-2 text-sm"),onClick:n,children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),confirm("Delete this trace?")&&c()},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-500/20 rounded text-red-400 text-xs",title:"Delete trace",children:"âœ•"}),(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2 pr-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p,{variant:x,children:"running"===r.status?(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"animate-pulse",children:"â—"})," Running"]}):r.status}),d&&(0,a.jsx)("span",{className:"text-xs text-slate-400 italic",children:"refinement"}),i&&i>0&&(0,a.jsxs)("span",{className:"text-xs text-slate-400",children:["+",i," refinement",i>1?"s":""]})]}),(0,a.jsx)("span",{className:"text-xs text-slate-400",children:(0,o.p6)(r.started_at)})]}),(0,a.jsx)("p",{className:(0,o.cn)("text-white mb-2",d?"text-xs":"text-sm"),children:(0,o.$G)(r.input_prompt,d?60:80)}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs text-slate-400",children:[(0,a.jsx)("span",{className:"font-mono",children:r.id.substring(0,8)}),"running"===r.status&&m.length>0&&(0,a.jsx)("span",{className:"text-amber-400 animate-pulse",children:(null===(s=m[0])||void 0===s?void 0:s.name)||"Processing..."}),"completed"===r.status&&r.total_tokens>0&&(0,a.jsxs)("span",{children:[r.total_tokens," tokens"]})]})]})}function g(){let e=(0,m.useRouter)(),t=(0,m.useSearchParams)(),[s,l]=(0,r.useState)(new Set),{traces:n,selectedTraceId:c,selectTrace:o,fetchTraces:d,fetchTraceDetail:x,deleteTrace:u,isLoading:p,error:g}=i(),f=(n||[]).some(e=>"running"===e.status),j=s=>{o(s);let a=new URLSearchParams(t.toString());a.set("trace",s),e.push("/dashboard?".concat(a.toString()),{scroll:!1})},v=e=>{l(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})};return((0,r.useEffect)(()=>{let e=t.get("trace");e&&e!==c&&o(e)},[t,o,c]),(0,r.useEffect)(()=>{d();let e=setInterval(d,f?2e3:5e3);return()=>clearInterval(e)},[d,f]),(0,r.useEffect)(()=>{if(!c||!n)return;let e=n.find(e=>e.id===c);if((null==e?void 0:e.status)!=="running")return;let t=setInterval(()=>{x(c)},2e3);return()=>clearInterval(t)},[c,n,x]),g)?(0,a.jsxs)("div",{className:"p-4 text-center text-red-400",children:[(0,a.jsx)("p",{children:"Error loading traces"}),(0,a.jsx)("p",{className:"text-sm",children:g})]}):p&&(!n||0===n.length)?(0,a.jsx)("div",{className:"p-4 text-center text-slate-400",children:(0,a.jsx)("p",{children:"Loading traces..."})}):n&&0!==n.length?(0,a.jsx)("div",{className:"space-y-2 p-2",children:n.map(e=>{var t;let r=e.child_traces&&e.child_traces.length>0,l=s.has(e.id);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-start gap-1",children:[r&&(0,a.jsx)("button",{onClick:()=>v(e.id),className:"mt-3 p-1 text-slate-400 hover:text-cyan-400 transition-colors text-xs",title:l?"Collapse":"Expand",children:l?"â–¼":"â–¶"}),!r&&(0,a.jsx)("div",{className:"w-5"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(h,{trace:e,isSelected:e.id===c,onClick:()=>j(e.id),onDelete:()=>u(e.id),childCount:null===(t=e.child_traces)||void 0===t?void 0:t.length})})]}),r&&l&&(0,a.jsx)("div",{className:"ml-6 mt-1 space-y-1 border-l-2 border-slate-600 pl-2",children:e.child_traces.map(e=>(0,a.jsx)(h,{trace:e,isSelected:e.id===c,onClick:()=>j(e.id),onDelete:()=>u(e.id),isChild:!0},e.id))})]},e.id)})}):(0,a.jsxs)("div",{className:"p-8 text-center text-slate-400",children:[(0,a.jsx)("p",{className:"text-lg mb-2",children:"No traces yet"}),(0,a.jsx)("p",{className:"text-sm",children:"Run a search to see traces here"})]})}let f=(0,n.Ue)((e,t)=>({query:"",isSearching:!1,currentTraceId:null,results:[],bundles:[],selectedSellers:[],error:null,setQuery:t=>e({query:t}),setResults:t=>e({results:t}),setBundles:t=>e({bundles:t}),toggleSellerSelection:t=>e(e=>{let s="".concat(t.seller_name,":").concat(t.phone_number);return e.selectedSellers.some(e=>e.id===s)?{selectedSellers:e.selectedSellers.filter(e=>e.id!==s)}:{selectedSellers:[...e.selectedSellers,{...t,id:s}]}}),isSellerSelected:(e,s)=>{let a="".concat(e,":").concat(s);return t().selectedSellers.some(e=>e.id===a)},clearSelection:()=>e({selectedSellers:[]}),setError:t=>e({error:t}),runSearch:async t=>{e({isSearching:!0,error:null,query:t});try{let s=await c.h.runQuery(t,"research");e({currentTraceId:s.trace_id,isSearching:!1})}catch(t){e({error:t instanceof Error?t.message:"Search failed",isSearching:!1})}}}));var j=s(7850);function v(e){let{bundles:t}=e,{toggleSellerSelection:s,isSellerSelected:l}=f(),[n,c]=(0,r.useState)("products"),i=(null==t?void 0:t.filter(e=>e.productCount>=1))||[];if(0===i.length)return null;let d=[...i].sort((e,t)=>{var s,a,r,l;return"price"===n?(null!==(s=e.totalPrice)&&void 0!==s?s:1/0)-(null!==(a=t.totalPrice)&&void 0!==a?a:1/0):t.productCount!==e.productCount?t.productCount-e.productCount:(null!==(r=e.totalPrice)&&void 0!==r?r:1/0)-(null!==(l=t.totalPrice)&&void 0!==l?l:1/0)}).slice(0,10),x=e=>{if(!e.contact)return;let t=e.products&&e.products.length>0?e.products.map(e=>e.name).join(", "):"Bundle";s({seller_name:e.storeName,phone_number:e.contact,product_name:t,listed_price:e.totalPrice||0})};return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-secondary",children:["Bundle Opportunities (",d.length," stores)"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-secondary",children:"Sort by:"}),(0,a.jsxs)("select",{value:n,onChange:e=>c(e.target.value),className:"text-xs bg-surface border border-surface-hover rounded px-2 py-1 text-primary",children:[(0,a.jsx)("option",{value:"products",children:"Most Products"}),(0,a.jsx)("option",{value:"price",children:"Lowest Price"})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-surface-hover text-left text-secondary",children:[(0,a.jsx)("th",{className:"px-3 py-2 w-10",children:"#"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"Store"}),(0,a.jsx)("th",{className:"px-3 py-2 w-20",children:"Rating"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"Products"}),(0,a.jsxs)("th",{className:"px-3 py-2 w-28 cursor-pointer hover:text-primary",onClick:()=>c("price"),children:["Total Price ","price"===n&&"â†‘"]}),(0,a.jsx)("th",{className:"px-3 py-2 w-28",children:"Contact"})]})}),(0,a.jsx)("tbody",{children:d.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b border-surface-hover hover:bg-surface-hover/50",children:[(0,a.jsx)("td",{className:"px-3 py-2 text-secondary",children:t+1}),(0,a.jsx)("td",{className:"px-3 py-2 font-medium",children:e.storeName}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.rating?(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-warning/20 text-warning text-xs",children:["â˜… ",e.rating]}):(0,a.jsx)("span",{className:"text-secondary",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsxs)("span",{className:"text-primary",children:[e.productCount,"/",e.totalProducts]}),e.products&&e.products.length>0&&(0,a.jsx)("ul",{className:"mt-1 space-y-1",children:e.products.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-secondary",children:[e.name,": ",(0,o.T4)(e.price,e.currency)]}),e.url&&(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"â†’"})]},t))})]})}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.totalPrice?(0,a.jsx)("span",{className:"text-success font-medium",children:(0,o.T4)(e.totalPrice,"ILS")}):(0,a.jsx)("span",{className:"text-secondary",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.contact?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:l(e.storeName,e.contact),onChange:()=>x(e),className:"w-4 h-4 cursor-pointer"}),(0,a.jsx)("a",{href:(0,o.kU)(e.contact),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-1 rounded bg-[#25D366] text-white text-xs hover:bg-[#128C7E]",children:"\uD83D\uDCAC"})]}):(0,a.jsx)("span",{className:"text-secondary",children:"-"})})]},e.storeName))})]})})]})}function N(e){let{result:t,productName:s}=e,{toggleSellerSelection:r,isSellerSelected:l}=f();return(0,a.jsxs)("tr",{className:"border-b border-surface-hover hover:bg-surface-hover/50",children:[(0,a.jsx)("td",{className:"px-3 py-2 text-secondary",children:t.index}),(0,a.jsx)("td",{className:"px-3 py-2 font-medium",children:t.seller}),(0,a.jsx)("td",{className:"px-3 py-2",children:t.rating?(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-warning/20 text-warning text-xs",children:["â˜… ",t.rating]}):(0,a.jsx)("span",{className:"text-secondary",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-2",children:t.price?(0,a.jsx)("span",{className:"text-success font-medium",children:(0,o.T4)(t.price,t.currency)}):(0,a.jsx)("span",{className:"text-secondary",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-2",children:t.url?(0,a.jsx)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline text-sm",children:"View â†’"}):(0,a.jsx)("span",{className:"text-secondary",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-2",children:t.phone?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:l(t.seller,t.phone),onChange:()=>{t.phone&&r({seller_name:t.seller,phone_number:t.phone,product_name:s,listed_price:t.price||0})},className:"w-4 h-4 cursor-pointer"}),(0,a.jsx)("a",{href:(0,o.kU)(t.phone),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-1 rounded bg-[#25D366] text-white text-xs hover:bg-[#128C7E]",children:"\uD83D\uDCAC"})]}):(0,a.jsx)("span",{className:"text-secondary",children:"-"})})]})}function b(e){let{productName:t,results:s}=e;return s&&0!==s.length?(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-primary mb-2",children:t}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-surface-hover text-left text-secondary",children:[(0,a.jsx)("th",{className:"px-3 py-2 w-10",children:"#"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"Seller"}),(0,a.jsx)("th",{className:"px-3 py-2 w-20",children:"Rating"}),(0,a.jsx)("th",{className:"px-3 py-2 w-28",children:"Price"}),(0,a.jsx)("th",{className:"px-3 py-2 w-20",children:"Link"}),(0,a.jsx)("th",{className:"px-3 py-2 w-24",children:"Contact"})]})}),(0,a.jsx)("tbody",{children:s.map(e=>(0,a.jsx)(N,{result:e,productName:t},"".concat(t,"-").concat(e.index)))})]})})]}):null}var y=s(6334);function w(e){return e.toLowerCase().replace(/[|]/g," ").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}function _(e){return e.toLowerCase().replace(/[^\w]/g,"")}function S(){let{selectedTrace:e}=i(),{selectedSellers:t,clearSelection:s}=f(),{generateDrafts:l,isGenerating:n}=(0,j.z)(),[o,d]=(0,r.useState)({}),[x,m]=(0,r.useState)({}),[u,p]=(0,r.useState)({}),{bundles:h,productSections:g}=(0,r.useMemo)(()=>{if(!(null==e?void 0:e.spans))return{bundles:[],productSections:[]};let t=e.spans.find(e=>e.tool_output);if(!(null==t?void 0:t.tool_output))return{bundles:[],productSections:[]};let s=t.tool_output;return{bundles:function(e){let t;if(!e.match(/=== BUNDLE OPPORTUNITIES \((\d+) stores\) ===/))return[];let s=e.match(RegExp("=== BUNDLE OPPORTUNITIES.*?(?=\\n\\n=== [^B]|$)","s"));if(!s)return[];let a=[],r=/(\d+)\.\s+([^\n]+?)(?:\s+\(Rating:\s*([\d.]+)\/5\))?\n([\s\S]*?)(?=\n\d+\.|$)/g;for(;null!==(t=r.exec(s[0]));){let e;let s=parseInt(t[1]),r=t[2].trim(),l=t[3]?parseFloat(t[3]):void 0,n=t[4],c=n.match(/Offers\s+(\d+)\/(\d+)\s+products/),i=c?parseInt(c[1]):0,o=c?parseInt(c[2]):0,d=[],x=/^\s+-\s+([^:]+):\s+([\d,]+)\s+(\w+)(?:\s*\|\s*(https?:\/\/[^\s]+))?/gm;for(;null!==(e=x.exec(n));)d.push({name:e[1].trim(),price:parseInt(e[2].replace(/,/g,"")),currency:e[3],url:e[4]||void 0});let m=n.match(/Total:\s+([\d,]+)/),u=m?parseInt(m[1].replace(/,/g,"")):void 0,p=n.match(/Contact:\s*(\+?[\d\s-]+)/),h=p?p[1].replace(/[\s-]/g,""):void 0;a.push({index:s,storeName:r,rating:l,productCount:i,totalProducts:o,products:d,totalPrice:u,contact:h})}return a}(s),productSections:function(e){let t;let s=[],a=/\n=== ([^=\n]+) ===\n/g,r=[];for(;null!==(t=a.exec(e));)t[1].includes("BUNDLE OPPORTUNITIES")||r.push({name:t[1].trim(),startIndex:t.index+t[0].length});for(let t=0;t<r.length;t++){let a=r[t].startIndex,l=t+1<r.length?r[t+1].startIndex-r[t+1].name.length-8:e.length,n=function(e){let t;let s=[],a=/(\d+)\.\s+([^\n]+?)(?:\s+\(Rating:\s*([\d.]+)\/5\))?(?:\s+\[([^\]]+)\])?\n([\s\S]*?)(?=\n\d+\.|$)/g;for(;null!==(t=a.exec(e));){let e=parseInt(t[1]),a=t[2].trim(),r=t[3]?parseFloat(t[3]):void 0,l=t[5],n=l.match(/Price:\s*([\d,]+)\s*(\w+)?/),c=n?parseInt(n[1].replace(/,/g,"")):void 0,i=(null==n?void 0:n[2])||"ILS",o=l.match(/URL:\s*(https?:\/\/[^\s]+)/),d=o?o[1]:void 0,x=l.match(/Contact:\s*(\+?[\d\s-]+)/),m=x?x[1].replace(/[\s-]/g,""):void 0;s.push({index:e,seller:a,rating:r,price:c,currency:i,url:d,phone:m})}return s}(e.slice(a,l));s.push({productName:r[t].name,results:n})}return s}(s)}},[e]);(0,r.useEffect)(()=>{c.h.getSellers().then(e=>{let t={},s={},a={};e.forEach(e=>{let r=e.whatsapp_number||e.phone_number;r&&(t[w(e.seller_name)]=r,s[_(e.seller_name)]=r,e.domain&&(a[e.domain]=r))}),m(t),p(s),d(a)}).catch(e=>{console.error("Failed to load sellers:",e)})},[]);let N=(e,t)=>{if(t){let e=function(e){try{let t=new URL(e).hostname.toLowerCase();if(t.startsWith("www.")&&(t=t.slice(4)),t.includes("google.com"))return null;return t}catch(e){return null}}(t);if(e&&o[e])return o[e]}let s=w(e);if(x[s])return x[s];for(let[e,t]of Object.entries(x))if(s.includes(e)||e.includes(s))return t;let a=_(e);if(u[a])return u[a];for(let[e,t]of Object.entries(u))if(a.includes(e)||e.includes(a))return t},S=(0,r.useMemo)(()=>h?h.map(e=>{var t,s;if(e.contact)return e;let a=N(e.storeName,null===(s=e.products)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.url);return a?{...e,contact:a}:e}):[],[h,o,x,u]),k=(0,r.useMemo)(()=>g?g.map(e=>({...e,results:(e.results||[]).map(e=>{if(e.phone)return e;let t=N(e.seller,e.url);return t?{...e,phone:t}:e})})):[],[g,o,x,u]);return((null==h?void 0:h.length)||0)>0||((null==g?void 0:g.length)||0)>0?(0,a.jsxs)("div",{className:"mt-4",children:[t&&t.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4 p-3 bg-primary/10 rounded-lg",children:[(0,a.jsxs)("span",{className:"text-sm",children:[(0,a.jsx)("strong",{children:t.length})," sellers selected"]}),(0,a.jsx)(y.z,{size:"sm",onClick:()=>{t&&t.length>0&&l(t)},disabled:n,children:n?"Generating...":"\uD83D\uDCDD Generate Drafts"}),(0,a.jsx)(y.z,{size:"sm",variant:"ghost",onClick:s,children:"Clear"})]}),S&&S.length>0&&(0,a.jsx)(v,{bundles:S}),k.map(e=>(0,a.jsx)(b,{productName:e.productName,results:e.results},e.productName))]}):null}function k(e){let t=e.name||"";return/^[ðŸ“¦ðŸ”âœ…âš ï¸âŒðŸ”„ðŸŽ¯â„¹ï¸]/.test(t)}function C(e){var t;let{span:s,depth:l=0}=e,[n,c]=(0,r.useState)(!1),i=s.status||"completed",d=s.name||"",x=(null===(t=d.match(/^[ðŸ“¦ðŸ”âœ…âš ï¸âŒðŸ”„ðŸŽ¯â„¹ï¸]/))||void 0===t?void 0:t[0])||"â€¢",m=d.replace(/^[ðŸ“¦ðŸ”âœ…âš ï¸âŒðŸ”„ðŸŽ¯â„¹ï¸]\s*/,""),u="running"===i?"text-warning":d.startsWith("âœ…")?"text-success":d.startsWith("âŒ")?"text-error":d.startsWith("âš ï¸")?"text-warning":"text-slate-400";return(0,a.jsxs)("div",{className:"border-l-2 border-slate-600 pl-3 py-1",style:{marginLeft:16*l},children:[(0,a.jsxs)("div",{className:"flex items-start gap-2 cursor-pointer hover:bg-slate-700-hover rounded px-1 -ml-1",onClick:()=>c(!n),children:[(0,a.jsx)("span",{className:"text-base",children:x}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("span",{className:"text-sm font-medium ".concat(u),children:m}),"running"===i&&(0,a.jsx)("span",{className:"ml-2 text-xs text-warning animate-pulse",children:"running..."})]}),(0,a.jsx)("span",{className:"text-xs text-slate-400 shrink-0",children:(0,o.LU)(s.duration_ms||0)})]}),n&&s.tool_output&&(0,a.jsx)("div",{className:"mt-1 ml-6 text-xs bg-slate-700 rounded p-2 whitespace-pre-wrap font-mono max-h-32 overflow-y-auto",children:"string"==typeof s.tool_output?s.tool_output:JSON.stringify(s.tool_output,null,2)})]})}function T(e){let{node:t,isParallel:s=!1}=e,[l,n]=(0,r.useState)(!1),{span:c,children:i,depth:d}=t,x=c.type||c.span_type||"function",m=c.status||"completed",u=e=>{if(!e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(t){return String(e)}},h=i.map((e,t)=>{let s=i.some((s,a)=>t!==a&&function(e,t){if(!e.started_at||!t.started_at)return!1;let s=new Date(e.started_at).getTime(),a=new Date(t.started_at).getTime(),r=e.ended_at?new Date(e.ended_at).getTime():Date.now();return s<(t.ended_at?new Date(t.ended_at).getTime():Date.now())&&a<r}(e.span,s.span));return{node:e,isParallel:s}}),g=["border-cyan-500/50","border-purple-500/50","border-amber-500/50","border-green-500/50","border-pink-500/50"],f=g[d%g.length];return(0,a.jsxs)("div",{className:"relative ".concat(d>0?"ml-4 border-l-2 ".concat(f," pl-3"):""),children:[s&&(0,a.jsx)("div",{className:"absolute -left-1 top-4 w-2 h-2 rounded-full bg-cyan-400",title:"Running in parallel"}),(0,a.jsxs)("div",{className:"bg-slate-700 rounded-lg overflow-hidden mb-2",children:[(0,a.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between cursor-pointer hover:bg-slate-700-hover",onClick:()=>n(!l),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[d>0&&(0,a.jsxs)("span",{className:"text-xs text-slate-400 opacity-50",children:["L",d]}),(0,a.jsx)(p,{variant:{llm_call:"primary",tool_call:"success",agent_run:"info",handoff:"warning",function:"secondary",agent:"info",tool:"success"}[x]||"secondary",className:"text-xs uppercase",children:x.replace("_"," ")}),(0,a.jsx)("span",{className:"font-medium",children:c.name||"Unknown"}),!0===c.cached&&(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"(Cached)"}),i.length>0&&(0,a.jsxs)("span",{className:"text-xs text-cyan-400",children:["(",i.length," child",i.length>1?"ren":"",")"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[void 0!==c.input_tokens&&(0,a.jsxs)("span",{className:"text-slate-400",children:[c.input_tokens," in"]}),void 0!==c.output_tokens&&(0,a.jsxs)("span",{className:"text-slate-400",children:[c.output_tokens," out"]}),null!==c.cached&&void 0!==c.cached&&(0,a.jsx)(p,{variant:c.cached?"secondary":"info",children:c.cached?"CACHED":"FRESH"}),(0,a.jsx)("span",{className:"text-slate-400",children:(0,o.LU)(c.duration_ms||0)}),(0,a.jsx)(p,{variant:{running:"warning",completed:"success",error:"error"}[m]||"success",children:m}),(0,a.jsx)("span",{className:"text-slate-400",children:l?"â–¼":"â–¶"})]})]}),l&&(0,a.jsxs)("div",{className:"px-4 py-3 bg-slate-800 border-t border-slate-600 space-y-3",children:[c.parent_span_id&&(0,a.jsxs)("div",{className:"text-xs text-slate-400",children:["Parent: ",(0,a.jsxs)("span",{className:"font-mono",children:[c.parent_span_id.slice(0,8),"..."]})]}),c.system_prompt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"System Prompt"}),(0,a.jsx)("pre",{className:"text-sm bg-slate-700 p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:c.system_prompt})]}),null!=c.input_messages&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"Input Messages"}),(0,a.jsx)("pre",{className:"text-sm bg-slate-700 p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:u(c.input_messages)})]}),c.output_content&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"Output"}),(0,a.jsx)("pre",{className:"text-sm bg-slate-700 p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:"string"==typeof c.output_content?c.output_content:JSON.stringify(c.output_content,null,2)})]}),null!=c.tool_input&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"Tool Input"}),(0,a.jsx)("pre",{className:"text-sm bg-slate-700 p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:u(c.tool_input)})]}),c.tool_output&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"Tool Output"}),(0,a.jsxs)("pre",{className:"text-sm bg-slate-700 p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:["string"==typeof c.tool_output?c.tool_output.slice(0,2e3):JSON.stringify(c.tool_output,null,2).slice(0,2e3),"string"==typeof c.tool_output&&c.tool_output.length>2e3&&"..."]})]}),c.error&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-error uppercase mb-1",children:"Error"}),(0,a.jsx)("pre",{className:"text-sm bg-error/10 text-error p-3 rounded overflow-x-auto whitespace-pre-wrap",children:c.error})]})]})]}),i.length>0&&(0,a.jsx)("div",{className:"space-y-1",children:h.map((e,t)=>{let{node:s,isParallel:r}=e;return(0,a.jsx)(T,{node:s,isParallel:r},s.span.id||s.span.span_id||t)})})]})}function E(e){let{span:t,index:s}=e,[l,n]=(0,r.useState)(!1),c=t.type||t.span_type||"function",i=t.status||"completed";return(0,a.jsxs)("div",{className:"bg-slate-700 rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between cursor-pointer hover:bg-slate-700-hover",onClick:()=>n(!l),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p,{variant:{llm_call:"primary",tool_call:"success",agent_run:"info",handoff:"warning",function:"secondary",agent:"info",tool:"success"}[c]||"secondary",className:"text-xs uppercase",children:c.replace("_"," ")}),(0,a.jsx)("span",{className:"font-medium",children:t.name||"Unknown"}),!0===t.cached&&(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"(Cached)"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[void 0!==t.input_tokens&&(0,a.jsxs)("span",{className:"text-slate-400",children:[t.input_tokens," in"]}),void 0!==t.output_tokens&&(0,a.jsxs)("span",{className:"text-slate-400",children:[t.output_tokens," out"]}),(0,a.jsx)("span",{className:"text-slate-400",children:(0,o.LU)(t.duration_ms||0)}),(0,a.jsx)(p,{variant:{running:"warning",completed:"success",error:"error"}[i]||"success",children:i}),(0,a.jsx)("span",{className:"text-slate-400",children:l?"â–¼":"â–¶"})]})]}),l&&(0,a.jsxs)("div",{className:"px-4 py-3 bg-slate-800 border-t border-slate-600 space-y-3",children:[t.system_prompt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"System Prompt"}),(0,a.jsx)("pre",{className:"text-sm bg-slate-700 p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:t.system_prompt})]}),null!=t.tool_input&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"Tool Input"}),(0,a.jsx)("pre",{className:"text-sm bg-slate-700 p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:(e=>{if(!e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(t){return String(e)}})(t.tool_input)})]}),t.tool_output&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"Tool Output"}),(0,a.jsx)("pre",{className:"text-sm bg-slate-700 p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:"string"==typeof t.tool_output?t.tool_output.slice(0,2e3):JSON.stringify(t.tool_output,null,2).slice(0,2e3)})]}),t.error&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-error uppercase mb-1",children:"Error"}),(0,a.jsx)("pre",{className:"text-sm bg-error/10 text-error p-3 rounded overflow-x-auto whitespace-pre-wrap",children:t.error})]})]})]})}function D(e){let{spans:t}=e,[s,l]=(0,r.useState)("nested"),{progressEvents:n,regularSpans:c,spanTree:i}=(0,r.useMemo)(()=>{let e=t.filter(k),s=t.filter(e=>!k(e)),a=function(e){let t=new Map,s=[];e.forEach(e=>{let s=e.id||e.span_id||"";t.set(s,{span:e,children:[],depth:0})}),e.forEach(e=>{let a=e.id||e.span_id||"",r=t.get(a);if(!r)return;let l=e.parent_span_id;if(l&&t.has(l)){let e=t.get(l);e.children.push(r),r.depth=e.depth+1}else s.push(r)});let a=e=>{e.children.sort((e,t)=>(e.span.started_at?new Date(e.span.started_at).getTime():0)-(t.span.started_at?new Date(t.span.started_at).getTime():0)),e.children.forEach(a)};s.sort((e,t)=>(e.span.started_at?new Date(e.span.started_at).getTime():0)-(t.span.started_at?new Date(t.span.started_at).getTime():0)),s.forEach(a);let r=(e,t)=>{e.depth=t,e.children.forEach(e=>r(e,t+1))};return s.forEach(e=>r(e,0)),s}(s);return{progressEvents:e,regularSpans:s,spanTree:a}},[t]);if(!t||0===t.length)return(0,a.jsx)("div",{className:"text-slate-400 text-sm py-4",children:"No spans recorded"});let o=c.some(e=>e.parent_span_id);return(0,a.jsxs)("div",{className:"space-y-4",children:[o&&c.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"View:"}),(0,a.jsx)("button",{onClick:()=>l("nested"),className:"px-2 py-1 text-xs rounded ".concat("nested"===s?"bg-cyan-500/20 text-cyan-400":"bg-slate-700 text-slate-400 hover:text-white"),children:"Nested"}),(0,a.jsx)("button",{onClick:()=>l("flat"),className:"px-2 py-1 text-xs rounded ".concat("flat"===s?"bg-cyan-500/20 text-cyan-400":"bg-slate-700 text-slate-400 hover:text-white"),children:"Flat"})]}),n.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-slate-400 mb-2",children:["Activity Timeline (",n.length," events)"]}),(0,a.jsx)("div",{className:"bg-slate-700 rounded-lg p-3 space-y-0",children:n.map((e,t)=>(0,a.jsx)(C,{span:e},e.id||e.span_id||t))})]}),c.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-slate-400 mb-2",children:["Trace Details (",c.length," spans)",o&&"nested"===s&&(0,a.jsx)("span",{className:"ml-2 text-xs text-cyan-400",children:"â€¢ nested view"})]}),"nested"===s&&o?(0,a.jsx)("div",{className:"space-y-2",children:i.map((e,t)=>(0,a.jsx)(T,{node:e},e.span.id||e.span.span_id||t))}):(0,a.jsx)("div",{className:"space-y-2",children:c.map((e,t)=>(0,a.jsx)(E,{span:e,index:t},e.id||e.span_id||t))})]}),o&&"nested"===s&&(0,a.jsxs)("div",{className:"text-xs text-slate-400 flex items-center gap-4 pt-2 border-t border-slate-600",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full bg-cyan-400"}),"Parallel execution"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"border-l-2 border-cyan-500/50 h-3"}),"Child of parent span"]})]})]})}function I(){var e,t,s,r,l,n,c,d,x,m;let{selectedTrace:u,selectedTraceId:h,isLoading:g}=i();if(!h)return(0,a.jsx)("div",{className:"h-full flex items-center justify-center text-slate-400",children:(0,a.jsx)("p",{children:"Select a trace to view details"})});if(g&&!u)return(0,a.jsx)("div",{className:"h-full flex items-center justify-center text-slate-400",children:(0,a.jsx)("p",{children:"Loading trace details..."})});if(!u)return(0,a.jsx)("div",{className:"h-full flex items-center justify-center text-red-400",children:(0,a.jsx)("p",{children:"Trace not found"})});let f="completed"===u.status?"success":"error"===u.status?"error":"warning",j=(null===(e=u.spans)||void 0===e?void 0:e.filter(e=>"running"===e.status))||[],v=(null===(t=u.spans)||void 0===t?void 0:t.filter(e=>"completed"===e.status))||[],N=(null===(s=u.spans)||void 0===s?void 0:s.filter(e=>"completed"===e.status&&"tool_call"===e.span_type&&e.tool_output))||[],b=(null===(r=u.spans)||void 0===r?void 0:r.length)||0,y=e=>{if(!e)return"";if("string"==typeof e)return e.slice(0,1e3)+(e.length>1e3?"...":"");try{let t=JSON.stringify(e,null,2);return t.slice(0,1e3)+(t.length>1e3?"...":"")}catch(t){return String(e).slice(0,1e3)}};return(0,a.jsxs)("div",{className:"h-full overflow-y-auto p-4",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)(p,{variant:f,children:u.status}),(0,a.jsx)("span",{className:"text-xs text-slate-400 font-mono cursor-pointer hover:text-cyan-400",onClick:()=>navigator.clipboard.writeText(u.id),title:"Click to copy",children:u.id})]}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-2",children:u.input_prompt}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm text-slate-400",children:[(0,a.jsxs)("span",{children:["Started: ",(0,o.p6)(u.started_at)]}),u.total_duration_ms>0&&(0,a.jsxs)("span",{children:["Duration: ",(0,o.LU)(u.total_duration_ms)]}),u.total_tokens>0&&(0,a.jsxs)("span",{children:["Tokens: ",u.total_tokens]})]})]}),u.operational_summary&&(0,a.jsxs)("details",{className:"mb-6",children:[(0,a.jsxs)("summary",{className:"text-sm font-medium text-slate-400 cursor-pointer hover:text-cyan-400 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"Operational Summary"}),(null===(l=u.operational_summary.errors)||void 0===l?void 0:l.length)>0&&(0,a.jsxs)(p,{variant:"error",children:[u.operational_summary.errors.length," errors"]}),(null===(n=u.operational_summary.warnings)||void 0===n?void 0:n.length)>0&&(0,a.jsxs)(p,{variant:"warning",children:[u.operational_summary.warnings.length," warnings"]})]}),(0,a.jsxs)("div",{className:"mt-3 bg-slate-700 rounded-lg p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-medium text-slate-400 uppercase mb-2",children:"Searches"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-cyan-400",children:u.operational_summary.google_searches||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Google Searches"})]}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:u.operational_summary.google_searches_cached||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Google (Cached)"})]}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-cyan-400",children:u.operational_summary.zap_searches||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Zap Searches"})]}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:u.operational_summary.zap_searches_cached||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Zap (Cached)"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-medium text-slate-400 uppercase mb-2",children:"Page Scrapes"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-cyan-400",children:u.operational_summary.page_scrapes||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Pages Scraped"})]}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:u.operational_summary.page_scrapes_cached||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Cached"})]})]})]}),(u.operational_summary.prices_extracted>0||u.operational_summary.prices_failed>0)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-medium text-slate-400 uppercase mb-2",children:"Extractions"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:u.operational_summary.prices_extracted||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Prices Found"})]}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-red-400",children:u.operational_summary.prices_failed||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Prices Failed"})]}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:u.operational_summary.contacts_extracted||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Contacts Found"})]}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-red-400",children:u.operational_summary.contacts_failed||0}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:"Contacts Failed"})]})]})]}),(null===(c=u.operational_summary.errors)||void 0===c?void 0:c.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-xs font-medium text-red-400 uppercase mb-2",children:["Errors (",u.operational_summary.errors.length,")"]}),(0,a.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:u.operational_summary.errors.map((e,t)=>(0,a.jsx)("div",{className:"bg-error/10 text-red-400 text-xs p-2 rounded font-mono",children:e},t))})]}),(null===(d=u.operational_summary.warnings)||void 0===d?void 0:d.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-xs font-medium text-amber-400 uppercase mb-2",children:["Warnings (",u.operational_summary.warnings.length,")"]}),(0,a.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:u.operational_summary.warnings.map((e,t)=>(0,a.jsx)("div",{className:"bg-warning/10 text-amber-400 text-xs p-2 rounded font-mono",children:e},t))})]})]})]}),"running"===u.status&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-warning/10 border border-warning/30 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-warning border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{className:"text-amber-400 font-medium",children:"Search in progress..."})]}),j.length>0&&(0,a.jsxs)("div",{className:"text-sm text-slate-400",children:[(0,a.jsxs)("p",{children:["Current: ",(null===(x=j[0])||void 0===x?void 0:x.name)||"Processing"]}),(null===(m=j[0])||void 0===m?void 0:m.tool_input)!=null&&"object"==typeof j[0].tool_input&&(0,a.jsxs)("p",{className:"text-xs mt-1",children:[JSON.stringify(j[0].tool_input).slice(0,100),"..."]})]}),b>0&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-slate-400",children:["Steps completed: ",v.length," / ",b]}),N.length>0&&(0,a.jsxs)("div",{className:"mt-4 border-t border-warning/20 pt-3",children:[(0,a.jsx)("p",{className:"text-xs text-slate-400 mb-2",children:"Results so far:"}),(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:N.map(e=>(0,a.jsxs)("div",{className:"bg-slate-700/50 rounded p-2 text-xs",children:[(0,a.jsx)("p",{className:"text-cyan-400 font-medium mb-1",children:e.name}),(0,a.jsx)("pre",{className:"text-slate-400 whitespace-pre-wrap font-mono text-[10px] max-h-32 overflow-y-auto",children:y(e.tool_output)})]},e.id))})]})]}),u.error&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-400 mb-2",children:"Error"}),(0,a.jsx)("div",{className:"bg-error/10 border border-error/30 rounded-lg p-4 text-sm text-red-400",children:u.error})]}),(0,a.jsx)(S,{}),u.spans&&u.spans.length>0&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(D,{spans:u.spans})}),u.final_output&&(0,a.jsxs)("details",{className:"mb-6",children:[(0,a.jsx)("summary",{className:"text-sm font-medium text-slate-400 mb-2 cursor-pointer hover:text-cyan-400",children:"Raw Output"}),(0,a.jsx)("div",{className:"bg-background rounded-lg p-4 text-sm whitespace-pre-wrap mt-2",children:u.final_output})]})]})}function R(){let{query:e,setQuery:t,isSearching:s,runSearch:l}=f(),[n,c]=(0,r.useState)(e);return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n.trim()&&(t(n),l(n))},className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value),placeholder:"Search for products (e.g., iPhone 15, Samsung TV...)",className:"flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500",disabled:s}),(0,a.jsx)(y.z,{type:"submit",disabled:s||!n.trim(),children:s?"Searching...":"Search"})]})}var L=s(3425);let P={DEBUG:"text-slate-400",INFO:"text-cyan-400",WARN:"text-amber-400",WARNING:"text-amber-400",ERROR:"text-red-400"},O={DEBUG:"bg-slate-500/20",INFO:"bg-cyan-500/20",WARN:"bg-amber-500/20",WARNING:"bg-amber-500/20",ERROR:"bg-red-500/20"};function U(){let[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[n,c]=(0,r.useState)(null),[i,o]=(0,r.useState)(""),[d,x]=(0,r.useState)(""),[m,u]=(0,r.useState)("app"),[p,h]=(0,r.useState)(!0),[g,f]=(0,r.useState)(0),[j,v]=(0,r.useState)(!1),[N,b]=(0,r.useState)(new Set),y=(0,r.useRef)(null),w=(0,r.useCallback)(async()=>{try{let e=new URLSearchParams({limit:"200",file:m});i&&e.append("level",i),d&&e.append("search",d);let s=await fetch("".concat("http://localhost:8000","/api/logs?").concat(e));if(!s.ok)throw Error("HTTP ".concat(s.status));let a=await s.json();t(a.logs),f(a.total),v(a.has_more),c(null)}catch(e){c(e instanceof Error?e.message:"Failed to fetch logs")}finally{l(!1)}},[i,d,m]);(0,r.useEffect)(()=>{if(w(),p){let e=setInterval(w,3e3);return()=>clearInterval(e)}},[w,p]);let _=e=>{b(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},S=e=>{try{return new Date(e).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(t){return e}};return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-slate-900 rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border-b border-slate-700 bg-slate-800/50",children:[(0,a.jsx)("h3",{className:"font-medium text-white",children:"Logs"}),(0,a.jsxs)("div",{className:"flex rounded-lg overflow-hidden border border-slate-600",children:[(0,a.jsx)("button",{onClick:()=>u("app"),className:"px-3 py-1 text-xs font-medium transition-colors ".concat("app"===m?"bg-cyan-500/20 text-cyan-400":"text-slate-400 hover:bg-slate-700"),children:"App"}),(0,a.jsx)("button",{onClick:()=>u("error"),className:"px-3 py-1 text-xs font-medium transition-colors ".concat("error"===m?"bg-red-500/20 text-red-400":"text-slate-400 hover:bg-slate-700"),children:"Errors"})]}),(0,a.jsxs)("select",{value:i,onChange:e=>o(e.target.value),className:"px-2 py-1 text-xs bg-slate-800 border border-slate-600 rounded-lg text-slate-300 focus:border-cyan-500 outline-none",children:[(0,a.jsx)("option",{value:"",children:"All levels"}),(0,a.jsx)("option",{value:"DEBUG",children:"DEBUG"}),(0,a.jsx)("option",{value:"INFO",children:"INFO"}),(0,a.jsx)("option",{value:"WARN",children:"WARN"}),(0,a.jsx)("option",{value:"ERROR",children:"ERROR"})]}),(0,a.jsx)("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"Search logs...",className:"flex-1 max-w-xs px-3 py-1 text-xs bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:border-cyan-500 outline-none"}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs text-slate-400 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:p,onChange:e=>h(e.target.checked),className:"w-3 h-3 rounded border-slate-500 bg-slate-700 checked:bg-cyan-500 checked:border-cyan-500"}),"Auto-refresh"]}),(0,a.jsx)("button",{onClick:w,disabled:s,className:"p-1.5 text-slate-400 hover:text-white rounded transition-colors",title:"Refresh",children:(0,a.jsx)("svg",{className:"w-4 h-4 ".concat(s?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:[g," entries"]})]}),(0,a.jsxs)("div",{ref:y,className:"flex-1 overflow-y-auto font-mono text-xs",children:[n?(0,a.jsxs)("div",{className:"p-4 text-red-400",children:["Error loading logs: ",n]}):0===e.length?(0,a.jsx)("div",{className:"p-4 text-slate-500 text-center",children:s?"Loading logs...":"No logs found"}):(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-slate-800 text-slate-400",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-2 py-1.5 text-left w-16",children:"Time"}),(0,a.jsx)("th",{className:"px-2 py-1.5 text-left w-16",children:"Level"}),(0,a.jsx)("th",{className:"px-2 py-1.5 text-left w-32",children:"Event"}),(0,a.jsx)("th",{className:"px-2 py-1.5 text-left",children:"Message / Data"})]})}),(0,a.jsx)("tbody",{children:e.map((e,t)=>{let s=N.has(t),r=Object.keys(e.data).length>0;return(0,a.jsxs)("tr",{onClick:()=>r&&_(t),className:"border-b border-slate-800 hover:bg-slate-800/50\n                              ".concat(r?"cursor-pointer":"","\n                              ").concat(s?"bg-slate-800/30":""),children:[(0,a.jsx)("td",{className:"px-2 py-1 text-slate-500 whitespace-nowrap align-top",children:(0,a.jsx)("span",{title:e.timestamp,children:S(e.timestamp)})}),(0,a.jsx)("td",{className:"px-2 py-1 align-top",children:(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium\n                                  ".concat(P[e.level]||"text-slate-400","\n                                  ").concat(O[e.level]||"bg-slate-500/20"),children:e.level})}),(0,a.jsx)("td",{className:"px-2 py-1 text-cyan-300 align-top truncate max-w-[8rem]",children:e.event}),(0,a.jsx)("td",{className:"px-2 py-1 text-slate-300 align-top",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[r&&(0,a.jsx)("span",{className:"text-slate-500 select-none",children:s?"â–¼":"â–¶"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[e.message&&(0,a.jsx)("div",{className:"truncate",children:e.message}),s&&r&&(0,a.jsx)("pre",{className:"mt-2 p-2 bg-slate-900 rounded text-slate-400 overflow-x-auto",children:JSON.stringify(e.data,null,2)})]})]})})]},t)})})]}),j&&(0,a.jsx)("div",{className:"p-2 text-center text-slate-500 text-xs",children:"Showing first 200 entries. Use filters to narrow down."})]})]})}let A="dashboard_auth_token";function F(){let[e,t]=(0,r.useState)("checking"),[s,l]=(0,r.useState)(""),[n,c]=(0,r.useState)(null),[i,o]=(0,r.useState)("traces");(0,r.useEffect)(()=>{(async()=>{try{let e="http://localhost:8000",s=await fetch("".concat(e,"/traces/auth/info"));if(!(await s.json()).auth_required){t("open");return}let a=localStorage.getItem(A);if(a){if((await fetch("".concat(e,"/traces/auth/check?auth=").concat(encodeURIComponent(a)))).ok){t("authenticated");return}localStorage.removeItem(A)}t("required")}catch(e){console.error("Auth check failed:",e),t("open")}})()},[]);let d=(0,r.useCallback)(async e=>{e.preventDefault(),c(null);try{(await fetch("".concat("http://localhost:8000","/traces/auth/check?auth=").concat(encodeURIComponent(s)))).ok?(localStorage.setItem(A,s),t("authenticated")):c("Invalid password")}catch(e){c("Authentication failed")}},[s]);return"checking"===e?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-900 text-white",children:(0,a.jsx)("div",{className:"text-slate-400",children:"Checking access..."})}):"required"===e?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-900 text-white",children:(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-8 w-full max-w-md",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold mb-6 text-center",children:"Dashboard Access"}),(0,a.jsxs)("form",{onSubmit:d,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm text-slate-400 mb-2",children:"Password"}),(0,a.jsx)("input",{id:"password",type:"password",value:s,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:"Enter dashboard password",autoFocus:!0})]}),n&&(0,a.jsx)("div",{className:"text-red-400 text-sm",children:n}),(0,a.jsx)("button",{type:"submit",className:"w-full py-2 bg-cyan-600 hover:bg-cyan-500 text-white font-medium rounded-lg transition-colors",children:"Access Dashboard"})]})]})}):(0,a.jsx)(W,{activeTab:i,setActiveTab:o})}function W(e){let{activeTab:t,setActiveTab:s}=e;return!function(){let e=(0,r.useRef)(null),t=(0,r.useRef)(),{setConnectionStatus:s,addTrace:a,updateTrace:l,fetchTraces:n,fetchTraceDetail:c,selectedTraceId:o}=i(),d=(0,r.useCallback)(e=>{let t=e.data||{};switch(e.event_type){case"trace_started":a({id:e.trace_id,input_prompt:t.input_prompt||"",status:"running",started_at:t.started_at||new Date().toISOString(),total_tokens:0,total_duration_ms:0,spans:[],operational_summary:t.operational_summary});break;case"trace_ended":l(e.trace_id,{status:t.error?"error":"completed",final_output:t.final_output,error:t.error,ended_at:t.ended_at||new Date().toISOString(),total_duration_ms:t.total_duration_ms,total_tokens:t.total_tokens,operational_summary:t.operational_summary});break;case"span_started":case"span_ended":n(),o&&e.trace_id===o&&c(o);break;default:console.log("Unknown event:",e.event_type)}},[a,l,n,c,o]),x=(0,r.useCallback)(()=>{s("connecting");let a=function(){let e="ws://localhost:8000";if(e)return e;{let e="https:"===window.location.protocol?"wss:":"ws:";return"".concat(e,"//").concat(window.location.host)}}(),r=new WebSocket("".concat(a,"/traces/ws"));e.current=r,r.onopen=()=>{console.log("WebSocket connected"),s("connected")},r.onclose=()=>{console.log("WebSocket disconnected"),s("disconnected"),t.current=setTimeout(x,3e3)},r.onerror=e=>{console.error("WebSocket error:",e),s("disconnected")},r.onmessage=e=>{try{let t=JSON.parse(e.data);d(t)}catch(e){console.error("Failed to parse WebSocket message:",e)}}},[s,d]);(0,r.useEffect)(()=>(x(),()=>{e.current&&e.current.close(),t.current&&clearTimeout(t.current)}),[x]),e.current}(),(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-slate-900 text-white",children:[(0,a.jsx)(x,{}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col p-4 gap-4",children:[(0,a.jsx)("section",{className:"bg-slate-800 rounded-lg p-4",children:(0,a.jsx)(R,{})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 bg-slate-800 rounded-lg p-1 w-fit",children:[(0,a.jsx)("button",{onClick:()=>s("traces"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("traces"===t?"bg-cyan-500/20 text-cyan-400":"text-slate-400 hover:text-white hover:bg-slate-700"),children:(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Traces"]})}),(0,a.jsx)("button",{onClick:()=>s("logs"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("logs"===t?"bg-cyan-500/20 text-cyan-400":"text-slate-400 hover:text-white hover:bg-slate-700"),children:(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Logs"]})})]}),"traces"===t?(0,a.jsxs)("div",{className:"flex-1 flex gap-4 min-h-0",children:[(0,a.jsxs)("aside",{className:"w-80 bg-slate-800 rounded-lg overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"px-4 py-3 border-b border-slate-700",children:(0,a.jsx)("h2",{className:"font-medium text-white",children:"Recent Traces"})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"p-4 text-center text-slate-400",children:"Loading..."}),children:(0,a.jsx)(g,{})})})]}),(0,a.jsx)("section",{className:"flex-1 bg-slate-800 rounded-lg overflow-hidden",children:(0,a.jsx)(I,{})})]}):(0,a.jsx)("div",{className:"flex-1 min-h-0",children:(0,a.jsx)(U,{})})]}),(0,a.jsx)(L.T,{})]})}}},function(e){e.O(0,[972,929,425,971,117,744],function(){return e(e.s=710)}),_N_E=e.O()}]);