(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{710:function(e,t,s){Promise.resolve().then(s.bind(s,434))},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return a.a}});var r=s(2972),a=s.n(r)},434:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return z}});var r=s(7437),a=s(2265),n=s(7648),l=s(9625),c=s(1837);let i=(0,l.Ue)((e,t)=>({traces:[],selectedTraceId:null,selectedTrace:null,connectionStatus:"connecting",isLoading:!1,error:null,setTraces:t=>e({traces:t||[]}),selectTrace:s=>{e({selectedTraceId:s}),s?t().fetchTraceDetail(s):e({selectedTrace:null})},setSelectedTraceDetail:t=>e({selectedTrace:t}),updateTrace:(t,s)=>e(e=>{var r;return{traces:(e.traces||[]).map(e=>e.id===t?{...e,...s}:e),selectedTrace:(null===(r=e.selectedTrace)||void 0===r?void 0:r.id)===t?{...e.selectedTrace,...s}:e.selectedTrace}}),addTrace:t=>e(e=>({traces:[t,...e.traces||[]].slice(0,50)})),deleteTrace:async t=>{try{await c.h.deleteTrace(t),e(e=>{var s;return{traces:(e.traces||[]).filter(e=>e.id!==t),selectedTraceId:e.selectedTraceId===t?null:e.selectedTraceId,selectedTrace:(null===(s=e.selectedTrace)||void 0===s?void 0:s.id)===t?null:e.selectedTrace}})}catch(e){console.error("Failed to delete trace:",e)}},setConnectionStatus:t=>e({connectionStatus:t}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),fetchTraces:async()=>{e({isLoading:!0,error:null});try{let t=await c.h.getTraces();e({traces:t||[],isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch traces",isLoading:!1})}},fetchTraceDetail:async t=>{e({isLoading:!0,error:null});try{let s=await c.h.getTrace(t);e({selectedTrace:s,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch trace",isLoading:!1})}}}));var o=s(3448);function d(){let e={connecting:{color:"bg-warning",text:"Connecting..."},connected:{color:"bg-success",text:"Connected"},disconnected:{color:"bg-error",text:"Disconnected"}}[i(e=>e.connectionStatus)];return(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-secondary",children:[(0,r.jsx)("span",{className:(0,o.cn)("w-2 h-2 rounded-full animate-pulse",e.color)}),(0,r.jsx)("span",{children:e.text})]})}function x(){return(0,r.jsxs)("header",{className:"h-14 bg-slate-800 border-b border-slate-700 px-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsx)("h1",{className:"text-lg font-semibold text-white",children:"Agent Dashboard"}),(0,r.jsx)("nav",{className:"flex items-center gap-4",children:(0,r.jsx)(n.default,{href:"/sellers",className:"text-sm text-slate-400 hover:text-white transition-colors",children:"Sellers DB"})})]}),(0,r.jsx)(d,{})]})}var u=s(9376);let m={default:"bg-surface text-secondary",success:"bg-success/20 text-success",warning:"bg-warning/20 text-warning",error:"bg-error/20 text-error",info:"bg-primary/20 text-primary",secondary:"bg-secondary/20 text-secondary",primary:"bg-primary/30 text-primary"};function p(e){let{variant:t="default",children:s,className:a}=e;return(0,r.jsx)("span",{className:(0,o.cn)("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",m[t],a),children:s})}function h(e){var t,s;let{trace:a,isSelected:n,onClick:l,onDelete:c,childCount:i,isChild:d}=e,x="completed"===a.status?"success":"error"===a.status?"error":"warning",u=(null===(t=a.spans)||void 0===t?void 0:t.filter(e=>"running"===e.status))||[];return(0,r.jsxs)("div",{"data-testid":"trace-item",className:(0,o.cn)("p-3 rounded-lg cursor-pointer transition-colors relative group","hover:bg-slate-700",n?"bg-slate-700 border border-cyan-500/50":"bg-slate-800","running"===a.status&&"border-l-2 border-l-amber-500",d&&"py-2 text-sm"),onClick:l,children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),confirm("Delete this trace?")&&c()},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-500/20 rounded text-red-400 text-xs",title:"Delete trace",children:"âœ•"}),(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2 pr-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p,{variant:x,children:"running"===a.status?(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"animate-pulse",children:"â—"})," Running"]}):a.status}),d&&(0,r.jsx)("span",{className:"text-xs text-slate-400 italic",children:"refinement"}),i&&i>0&&(0,r.jsxs)("span",{className:"text-xs text-slate-400",children:["+",i," refinement",i>1?"s":""]})]}),(0,r.jsx)("span",{className:"text-xs text-slate-400",children:(0,o.p6)(a.started_at)})]}),(0,r.jsx)("p",{className:(0,o.cn)("text-white mb-2",d?"text-xs":"text-sm"),children:(0,o.$G)(a.input_prompt,d?60:80)}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-xs text-slate-400",children:[(0,r.jsx)("span",{className:"font-mono",children:a.id.substring(0,8)}),"running"===a.status&&u.length>0&&(0,r.jsx)("span",{className:"text-amber-400 animate-pulse",children:(null===(s=u[0])||void 0===s?void 0:s.name)||"Processing..."}),"completed"===a.status&&a.total_tokens>0&&(0,r.jsxs)("span",{children:[a.total_tokens," tokens"]})]})]})}function g(){let e=(0,u.useRouter)(),t=(0,u.useSearchParams)(),[s,n]=(0,a.useState)(new Set),{traces:l,selectedTraceId:c,selectTrace:o,fetchTraces:d,fetchTraceDetail:x,deleteTrace:m,isLoading:p,error:g}=i(),f=(l||[]).some(e=>"running"===e.status),j=s=>{o(s);let r=new URLSearchParams(t.toString());r.set("trace",s),e.push("/dashboard?".concat(r.toString()),{scroll:!1})},v=e=>{n(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})};return((0,a.useEffect)(()=>{let e=t.get("trace");e&&e!==c&&o(e)},[t,o,c]),(0,a.useEffect)(()=>{d();let e=setInterval(d,f?2e3:5e3);return()=>clearInterval(e)},[d,f]),(0,a.useEffect)(()=>{if(!c||!l)return;let e=l.find(e=>e.id===c);if((null==e?void 0:e.status)!=="running")return;let t=setInterval(()=>{x(c)},2e3);return()=>clearInterval(t)},[c,l,x]),g)?(0,r.jsxs)("div",{className:"p-4 text-center text-red-400",children:[(0,r.jsx)("p",{children:"Error loading traces"}),(0,r.jsx)("p",{className:"text-sm",children:g})]}):p&&(!l||0===l.length)?(0,r.jsx)("div",{className:"p-4 text-center text-slate-400",children:(0,r.jsx)("p",{children:"Loading traces..."})}):l&&0!==l.length?(0,r.jsx)("div",{className:"space-y-2 p-2",children:l.map(e=>{var t;let a=e.child_traces&&e.child_traces.length>0,n=s.has(e.id);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-start gap-1",children:[a&&(0,r.jsx)("button",{onClick:()=>v(e.id),className:"mt-3 p-1 text-slate-400 hover:text-cyan-400 transition-colors text-xs",title:n?"Collapse":"Expand",children:n?"â–¼":"â–¶"}),!a&&(0,r.jsx)("div",{className:"w-5"}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(h,{trace:e,isSelected:e.id===c,onClick:()=>j(e.id),onDelete:()=>m(e.id),childCount:null===(t=e.child_traces)||void 0===t?void 0:t.length})})]}),a&&n&&(0,r.jsx)("div",{className:"ml-6 mt-1 space-y-1 border-l-2 border-slate-600 pl-2",children:e.child_traces.map(e=>(0,r.jsx)(h,{trace:e,isSelected:e.id===c,onClick:()=>j(e.id),onDelete:()=>m(e.id),isChild:!0},e.id))})]},e.id)})}):(0,r.jsxs)("div",{className:"p-8 text-center text-slate-400",children:[(0,r.jsx)("p",{className:"text-lg mb-2",children:"No traces yet"}),(0,r.jsx)("p",{className:"text-sm",children:"Run a search to see traces here"})]})}let f=(0,l.Ue)((e,t)=>({query:"",isSearching:!1,currentTraceId:null,results:[],bundles:[],selectedSellers:[],error:null,setQuery:t=>e({query:t}),setResults:t=>e({results:t}),setBundles:t=>e({bundles:t}),toggleSellerSelection:t=>e(e=>{let s="".concat(t.seller_name,":").concat(t.phone_number);return e.selectedSellers.some(e=>e.id===s)?{selectedSellers:e.selectedSellers.filter(e=>e.id!==s)}:{selectedSellers:[...e.selectedSellers,{...t,id:s}]}}),isSellerSelected:(e,s)=>{let r="".concat(e,":").concat(s);return t().selectedSellers.some(e=>e.id===r)},clearSelection:()=>e({selectedSellers:[]}),setError:t=>e({error:t}),runSearch:async t=>{e({isSearching:!0,error:null,query:t});try{let s=await c.h.runQuery(t,"research");e({currentTraceId:s.trace_id,isSearching:!1})}catch(t){e({error:t instanceof Error?t.message:"Search failed",isSearching:!1})}}}));var j=s(7850);function v(e){let{bundles:t}=e,{toggleSellerSelection:s,isSellerSelected:n}=f(),[l,c]=(0,a.useState)("products"),i=(null==t?void 0:t.filter(e=>e.productCount>=1))||[];if(0===i.length)return null;let d=[...i].sort((e,t)=>{var s,r,a,n;return"price"===l?(null!==(s=e.totalPrice)&&void 0!==s?s:1/0)-(null!==(r=t.totalPrice)&&void 0!==r?r:1/0):t.productCount!==e.productCount?t.productCount-e.productCount:(null!==(a=e.totalPrice)&&void 0!==a?a:1/0)-(null!==(n=t.totalPrice)&&void 0!==n?n:1/0)}).slice(0,10),x=e=>{if(!e.contact)return;let t=e.products&&e.products.length>0?e.products.map(e=>e.name).join(", "):"Bundle";s({seller_name:e.storeName,phone_number:e.contact,product_name:t,listed_price:e.totalPrice||0})};return(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-secondary",children:["Bundle Opportunities (",d.length," stores)"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-secondary",children:"Sort by:"}),(0,r.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"text-xs bg-surface border border-surface-hover rounded px-2 py-1 text-primary",children:[(0,r.jsx)("option",{value:"products",children:"Most Products"}),(0,r.jsx)("option",{value:"price",children:"Lowest Price"})]})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-surface-hover text-left text-secondary",children:[(0,r.jsx)("th",{className:"px-3 py-2 w-10",children:"#"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Store"}),(0,r.jsx)("th",{className:"px-3 py-2 w-20",children:"Rating"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Products"}),(0,r.jsxs)("th",{className:"px-3 py-2 w-28 cursor-pointer hover:text-primary",onClick:()=>c("price"),children:["Total Price ","price"===l&&"â†‘"]}),(0,r.jsx)("th",{className:"px-3 py-2 w-28",children:"Contact"})]})}),(0,r.jsx)("tbody",{children:d.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b border-surface-hover hover:bg-surface-hover/50",children:[(0,r.jsx)("td",{className:"px-3 py-2 text-secondary",children:t+1}),(0,r.jsx)("td",{className:"px-3 py-2 font-medium",children:e.storeName}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.rating?(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-warning/20 text-warning text-xs",children:["â˜… ",e.rating]}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsxs)("div",{className:"text-xs",children:[(0,r.jsxs)("span",{className:"text-primary",children:[e.productCount,"/",e.totalProducts]}),e.products&&e.products.length>0&&(0,r.jsx)("ul",{className:"mt-1 space-y-1",children:e.products.map((e,t)=>(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-secondary",children:[e.name,": ",(0,o.T4)(e.price,e.currency)]}),e.url&&(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"â†’"})]},t))})]})}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.totalPrice?(0,r.jsx)("span",{className:"text-success font-medium",children:(0,o.T4)(e.totalPrice,"ILS")}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.contact?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:n(e.storeName,e.contact),onChange:()=>x(e),className:"w-4 h-4 cursor-pointer"}),(0,r.jsx)("a",{href:(0,o.kU)(e.contact),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-1 rounded bg-[#25D366] text-white text-xs hover:bg-[#128C7E]",children:"\uD83D\uDCAC"})]}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})})]},e.storeName))})]})})]})}function N(e){let{result:t,productName:s}=e,{toggleSellerSelection:a,isSellerSelected:n}=f();return(0,r.jsxs)("tr",{className:"border-b border-surface-hover hover:bg-surface-hover/50",children:[(0,r.jsx)("td",{className:"px-3 py-2 text-secondary",children:t.index}),(0,r.jsx)("td",{className:"px-3 py-2 font-medium",children:t.seller}),(0,r.jsx)("td",{className:"px-3 py-2",children:t.rating?(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-warning/20 text-warning text-xs",children:["â˜… ",t.rating]}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:t.price?(0,r.jsx)("span",{className:"text-success font-medium",children:(0,o.T4)(t.price,t.currency)}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:t.url?(0,r.jsx)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline text-sm",children:"View â†’"}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:t.phone?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:n(t.seller,t.phone),onChange:()=>{t.phone&&a({seller_name:t.seller,phone_number:t.phone,product_name:s,listed_price:t.price||0})},className:"w-4 h-4 cursor-pointer"}),(0,r.jsx)("a",{href:(0,o.kU)(t.phone),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-1 rounded bg-[#25D366] text-white text-xs hover:bg-[#128C7E]",children:"\uD83D\uDCAC"})]}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})})]})}function y(e){let{productName:t,results:s}=e;return s&&0!==s.length?(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-primary mb-2",children:t}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-surface-hover text-left text-secondary",children:[(0,r.jsx)("th",{className:"px-3 py-2 w-10",children:"#"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Seller"}),(0,r.jsx)("th",{className:"px-3 py-2 w-20",children:"Rating"}),(0,r.jsx)("th",{className:"px-3 py-2 w-28",children:"Price"}),(0,r.jsx)("th",{className:"px-3 py-2 w-20",children:"Link"}),(0,r.jsx)("th",{className:"px-3 py-2 w-24",children:"Contact"})]})}),(0,r.jsx)("tbody",{children:s.map(e=>(0,r.jsx)(N,{result:e,productName:t},"".concat(t,"-").concat(e.index)))})]})})]}):null}var b=s(6334);function w(e){return e.toLowerCase().replace(/[|]/g," ").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}function _(e){return e.toLowerCase().replace(/[^\w]/g,"")}function S(){let{selectedTrace:e}=i(),{selectedSellers:t,clearSelection:s}=f(),{generateDrafts:n,isGenerating:l}=(0,j.z)(),[o,d]=(0,a.useState)({}),[x,u]=(0,a.useState)({}),[m,p]=(0,a.useState)({}),{bundles:h,productSections:g}=(0,a.useMemo)(()=>{if(!(null==e?void 0:e.spans))return{bundles:[],productSections:[]};let t=e.spans.find(e=>e.tool_output);if(!(null==t?void 0:t.tool_output))return{bundles:[],productSections:[]};let s=t.tool_output;return{bundles:function(e){let t;if(!e.match(/=== BUNDLE OPPORTUNITIES \((\d+) stores\) ===/))return[];let s=e.match(RegExp("=== BUNDLE OPPORTUNITIES.*?(?=\\n\\n=== [^B]|$)","s"));if(!s)return[];let r=[],a=/(\d+)\.\s+([^\n]+?)(?:\s+\(Rating:\s*([\d.]+)\/5\))?\n([\s\S]*?)(?=\n\d+\.|$)/g;for(;null!==(t=a.exec(s[0]));){let e;let s=parseInt(t[1]),a=t[2].trim(),n=t[3]?parseFloat(t[3]):void 0,l=t[4],c=l.match(/Offers\s+(\d+)\/(\d+)\s+products/),i=c?parseInt(c[1]):0,o=c?parseInt(c[2]):0,d=[],x=/^\s+-\s+([^:]+):\s+([\d,]+)\s+(\w+)(?:\s*\|\s*(https?:\/\/[^\s]+))?/gm;for(;null!==(e=x.exec(l));)d.push({name:e[1].trim(),price:parseInt(e[2].replace(/,/g,"")),currency:e[3],url:e[4]||void 0});let u=l.match(/Total:\s+([\d,]+)/),m=u?parseInt(u[1].replace(/,/g,"")):void 0,p=l.match(/Contact:\s*(\+?[\d\s-]+)/),h=p?p[1].replace(/[\s-]/g,""):void 0;r.push({index:s,storeName:a,rating:n,productCount:i,totalProducts:o,products:d,totalPrice:m,contact:h})}return r}(s),productSections:function(e){let t;let s=[],r=/\n=== ([^=\n]+) ===\n/g,a=[];for(;null!==(t=r.exec(e));)t[1].includes("BUNDLE OPPORTUNITIES")||a.push({name:t[1].trim(),startIndex:t.index+t[0].length});for(let t=0;t<a.length;t++){let r=a[t].startIndex,n=t+1<a.length?a[t+1].startIndex-a[t+1].name.length-8:e.length,l=function(e){let t;let s=[],r=/(\d+)\.\s+([^\n]+?)(?:\s+\(Rating:\s*([\d.]+)\/5\))?(?:\s+\[([^\]]+)\])?\n([\s\S]*?)(?=\n\d+\.|$)/g;for(;null!==(t=r.exec(e));){let e=parseInt(t[1]),r=t[2].trim(),a=t[3]?parseFloat(t[3]):void 0,n=t[5],l=n.match(/Price:\s*([\d,]+)\s*(\w+)?/),c=l?parseInt(l[1].replace(/,/g,"")):void 0,i=(null==l?void 0:l[2])||"ILS",o=n.match(/URL:\s*(https?:\/\/[^\s]+)/),d=o?o[1]:void 0,x=n.match(/Contact:\s*(\+?[\d\s-]+)/),u=x?x[1].replace(/[\s-]/g,""):void 0;s.push({index:e,seller:r,rating:a,price:c,currency:i,url:d,phone:u})}return s}(e.slice(r,n));s.push({productName:a[t].name,results:l})}return s}(s)}},[e]);(0,a.useEffect)(()=>{c.h.getSellers().then(e=>{let t={},s={},r={};e.forEach(e=>{let a=e.whatsapp_number||e.phone_number;a&&(t[w(e.seller_name)]=a,s[_(e.seller_name)]=a,e.domain&&(r[e.domain]=a))}),u(t),p(s),d(r)}).catch(e=>{console.error("Failed to load sellers:",e)})},[]);let N=(e,t)=>{if(t){let e=function(e){try{let t=new URL(e).hostname.toLowerCase();if(t.startsWith("www.")&&(t=t.slice(4)),t.includes("google.com"))return null;return t}catch(e){return null}}(t);if(e&&o[e])return o[e]}let s=w(e);if(x[s])return x[s];for(let[e,t]of Object.entries(x))if(s.includes(e)||e.includes(s))return t;let r=_(e);if(m[r])return m[r];for(let[e,t]of Object.entries(m))if(r.includes(e)||e.includes(r))return t},S=(0,a.useMemo)(()=>h?h.map(e=>{var t,s;if(e.contact)return e;let r=N(e.storeName,null===(s=e.products)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.url);return r?{...e,contact:r}:e}):[],[h,o,x,m]),k=(0,a.useMemo)(()=>g?g.map(e=>({...e,results:(e.results||[]).map(e=>{if(e.phone)return e;let t=N(e.seller,e.url);return t?{...e,phone:t}:e})})):[],[g,o,x,m]);return((null==h?void 0:h.length)||0)>0||((null==g?void 0:g.length)||0)>0?(0,r.jsxs)("div",{className:"mt-4",children:[t&&t.length>0&&(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4 p-3 bg-primary/10 rounded-lg",children:[(0,r.jsxs)("span",{className:"text-sm",children:[(0,r.jsx)("strong",{children:t.length})," sellers selected"]}),(0,r.jsx)(b.z,{size:"sm",onClick:()=>{t&&t.length>0&&n(t)},disabled:l,children:l?"Generating...":"\uD83D\uDCDD Generate Drafts"}),(0,r.jsx)(b.z,{size:"sm",variant:"ghost",onClick:s,children:"Clear"})]}),S&&S.length>0&&(0,r.jsx)(v,{bundles:S}),k.map(e=>(0,r.jsx)(y,{productName:e.productName,results:e.results},e.productName))]}):null}function k(e){let t=e.name||"";return/^[ðŸ“¦ðŸ”âœ…âš ï¸âŒðŸ”„ðŸŽ¯â„¹ï¸]/.test(t)}function C(e){var t;let{span:s,depth:n=0}=e,[l,c]=(0,a.useState)(!1),i=s.status||"completed",d=s.name||"",x=(null===(t=d.match(/^[ðŸ“¦ðŸ”âœ…âš ï¸âŒðŸ”„ðŸŽ¯â„¹ï¸]/))||void 0===t?void 0:t[0])||"â€¢",u=d.replace(/^[ðŸ“¦ðŸ”âœ…âš ï¸âŒðŸ”„ðŸŽ¯â„¹ï¸]\s*/,""),m="running"===i?"text-warning":d.startsWith("âœ…")?"text-success":d.startsWith("âŒ")?"text-error":d.startsWith("âš ï¸")?"text-warning":"text-secondary";return(0,r.jsxs)("div",{className:"border-l-2 border-surface-hover pl-3 py-1",style:{marginLeft:16*n},children:[(0,r.jsxs)("div",{className:"flex items-start gap-2 cursor-pointer hover:bg-surface-hover rounded px-1 -ml-1",onClick:()=>c(!l),children:[(0,r.jsx)("span",{className:"text-base",children:x}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("span",{className:"text-sm font-medium ".concat(m),children:u}),"running"===i&&(0,r.jsx)("span",{className:"ml-2 text-xs text-warning animate-pulse",children:"running..."})]}),(0,r.jsx)("span",{className:"text-xs text-secondary shrink-0",children:(0,o.LU)(s.duration_ms||0)})]}),l&&s.tool_output&&(0,r.jsx)("div",{className:"mt-1 ml-6 text-xs bg-surface rounded p-2 whitespace-pre-wrap font-mono max-h-32 overflow-y-auto",children:"string"==typeof s.tool_output?s.tool_output:JSON.stringify(s.tool_output,null,2)})]})}function T(e){let{node:t,isParallel:s=!1}=e,[n,l]=(0,a.useState)(!1),{span:c,children:i,depth:d}=t,x=c.type||c.span_type||"function",u=c.status||"completed",m=e=>{if(!e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(t){return String(e)}},h=i.map((e,t)=>{let s=i.some((s,r)=>t!==r&&function(e,t){if(!e.started_at||!t.started_at)return!1;let s=new Date(e.started_at).getTime(),r=new Date(t.started_at).getTime(),a=e.ended_at?new Date(e.ended_at).getTime():Date.now();return s<(t.ended_at?new Date(t.ended_at).getTime():Date.now())&&r<a}(e.span,s.span));return{node:e,isParallel:s}}),g=["border-cyan-500/50","border-purple-500/50","border-amber-500/50","border-green-500/50","border-pink-500/50"],f=g[d%g.length];return(0,r.jsxs)("div",{className:"relative ".concat(d>0?"ml-4 border-l-2 ".concat(f," pl-3"):""),children:[s&&(0,r.jsx)("div",{className:"absolute -left-1 top-4 w-2 h-2 rounded-full bg-cyan-400",title:"Running in parallel"}),(0,r.jsxs)("div",{className:"bg-surface rounded-lg overflow-hidden mb-2",children:[(0,r.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between cursor-pointer hover:bg-surface-hover",onClick:()=>l(!n),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[d>0&&(0,r.jsxs)("span",{className:"text-xs text-secondary opacity-50",children:["L",d]}),(0,r.jsx)(p,{variant:{llm_call:"primary",tool_call:"success",agent_run:"info",handoff:"warning",function:"secondary",agent:"info",tool:"success"}[x]||"secondary",className:"text-xs uppercase",children:x.replace("_"," ")}),(0,r.jsx)("span",{className:"font-medium",children:c.name||"Unknown"}),!0===c.cached&&(0,r.jsx)("span",{className:"text-xs text-secondary",children:"(Cached)"}),i.length>0&&(0,r.jsxs)("span",{className:"text-xs text-cyan-400",children:["(",i.length," child",i.length>1?"ren":"",")"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[void 0!==c.input_tokens&&(0,r.jsxs)("span",{className:"text-secondary",children:[c.input_tokens," in"]}),void 0!==c.output_tokens&&(0,r.jsxs)("span",{className:"text-secondary",children:[c.output_tokens," out"]}),null!==c.cached&&void 0!==c.cached&&(0,r.jsx)(p,{variant:c.cached?"secondary":"info",children:c.cached?"CACHED":"FRESH"}),(0,r.jsx)("span",{className:"text-secondary",children:(0,o.LU)(c.duration_ms||0)}),(0,r.jsx)(p,{variant:{running:"warning",completed:"success",error:"error"}[u]||"success",children:u}),(0,r.jsx)("span",{className:"text-secondary",children:n?"â–¼":"â–¶"})]})]}),n&&(0,r.jsxs)("div",{className:"px-4 py-3 bg-background border-t border-surface-hover space-y-3",children:[c.parent_span_id&&(0,r.jsxs)("div",{className:"text-xs text-secondary",children:["Parent: ",(0,r.jsxs)("span",{className:"font-mono",children:[c.parent_span_id.slice(0,8),"..."]})]}),c.system_prompt&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"System Prompt"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:c.system_prompt})]}),null!=c.input_messages&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Input Messages"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:m(c.input_messages)})]}),c.output_content&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Output"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:"string"==typeof c.output_content?c.output_content:JSON.stringify(c.output_content,null,2)})]}),null!=c.tool_input&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Tool Input"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:m(c.tool_input)})]}),c.tool_output&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Tool Output"}),(0,r.jsxs)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:["string"==typeof c.tool_output?c.tool_output.slice(0,2e3):JSON.stringify(c.tool_output,null,2).slice(0,2e3),"string"==typeof c.tool_output&&c.tool_output.length>2e3&&"..."]})]}),c.error&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-error uppercase mb-1",children:"Error"}),(0,r.jsx)("pre",{className:"text-sm bg-error/10 text-error p-3 rounded overflow-x-auto whitespace-pre-wrap",children:c.error})]})]})]}),i.length>0&&(0,r.jsx)("div",{className:"space-y-1",children:h.map((e,t)=>{let{node:s,isParallel:a}=e;return(0,r.jsx)(T,{node:s,isParallel:a},s.span.id||s.span.span_id||t)})})]})}function D(e){let{span:t,index:s}=e,[n,l]=(0,a.useState)(!1),c=t.type||t.span_type||"function",i=t.status||"completed";return(0,r.jsxs)("div",{className:"bg-surface rounded-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between cursor-pointer hover:bg-surface-hover",onClick:()=>l(!n),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p,{variant:{llm_call:"primary",tool_call:"success",agent_run:"info",handoff:"warning",function:"secondary",agent:"info",tool:"success"}[c]||"secondary",className:"text-xs uppercase",children:c.replace("_"," ")}),(0,r.jsx)("span",{className:"font-medium",children:t.name||"Unknown"}),!0===t.cached&&(0,r.jsx)("span",{className:"text-xs text-secondary",children:"(Cached)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[void 0!==t.input_tokens&&(0,r.jsxs)("span",{className:"text-secondary",children:[t.input_tokens," in"]}),void 0!==t.output_tokens&&(0,r.jsxs)("span",{className:"text-secondary",children:[t.output_tokens," out"]}),(0,r.jsx)("span",{className:"text-secondary",children:(0,o.LU)(t.duration_ms||0)}),(0,r.jsx)(p,{variant:{running:"warning",completed:"success",error:"error"}[i]||"success",children:i}),(0,r.jsx)("span",{className:"text-secondary",children:n?"â–¼":"â–¶"})]})]}),n&&(0,r.jsxs)("div",{className:"px-4 py-3 bg-background border-t border-surface-hover space-y-3",children:[t.system_prompt&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"System Prompt"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:t.system_prompt})]}),null!=t.tool_input&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Tool Input"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:(e=>{if(!e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(t){return String(e)}})(t.tool_input)})]}),t.tool_output&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Tool Output"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:"string"==typeof t.tool_output?t.tool_output.slice(0,2e3):JSON.stringify(t.tool_output,null,2).slice(0,2e3)})]}),t.error&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-error uppercase mb-1",children:"Error"}),(0,r.jsx)("pre",{className:"text-sm bg-error/10 text-error p-3 rounded overflow-x-auto whitespace-pre-wrap",children:t.error})]})]})]})}function E(e){let{spans:t}=e,[s,n]=(0,a.useState)("nested"),{progressEvents:l,regularSpans:c,spanTree:i}=(0,a.useMemo)(()=>{let e=t.filter(k),s=t.filter(e=>!k(e)),r=function(e){let t=new Map,s=[];e.forEach(e=>{let s=e.id||e.span_id||"";t.set(s,{span:e,children:[],depth:0})}),e.forEach(e=>{let r=e.id||e.span_id||"",a=t.get(r);if(!a)return;let n=e.parent_span_id;if(n&&t.has(n)){let e=t.get(n);e.children.push(a),a.depth=e.depth+1}else s.push(a)});let r=e=>{e.children.sort((e,t)=>(e.span.started_at?new Date(e.span.started_at).getTime():0)-(t.span.started_at?new Date(t.span.started_at).getTime():0)),e.children.forEach(r)};s.sort((e,t)=>(e.span.started_at?new Date(e.span.started_at).getTime():0)-(t.span.started_at?new Date(t.span.started_at).getTime():0)),s.forEach(r);let a=(e,t)=>{e.depth=t,e.children.forEach(e=>a(e,t+1))};return s.forEach(e=>a(e,0)),s}(s);return{progressEvents:e,regularSpans:s,spanTree:r}},[t]);if(!t||0===t.length)return(0,r.jsx)("div",{className:"text-secondary text-sm py-4",children:"No spans recorded"});let o=c.some(e=>e.parent_span_id);return(0,r.jsxs)("div",{className:"space-y-4",children:[o&&c.length>0&&(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-secondary",children:"View:"}),(0,r.jsx)("button",{onClick:()=>n("nested"),className:"px-2 py-1 text-xs rounded ".concat("nested"===s?"bg-cyan-500/20 text-cyan-400":"bg-surface text-secondary hover:text-white"),children:"Nested"}),(0,r.jsx)("button",{onClick:()=>n("flat"),className:"px-2 py-1 text-xs rounded ".concat("flat"===s?"bg-cyan-500/20 text-cyan-400":"bg-surface text-secondary hover:text-white"),children:"Flat"})]}),l.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-secondary mb-2",children:["Activity Timeline (",l.length," events)"]}),(0,r.jsx)("div",{className:"bg-surface rounded-lg p-3 space-y-0",children:l.map((e,t)=>(0,r.jsx)(C,{span:e},e.id||e.span_id||t))})]}),c.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-secondary mb-2",children:["Trace Details (",c.length," spans)",o&&"nested"===s&&(0,r.jsx)("span",{className:"ml-2 text-xs text-cyan-400",children:"â€¢ nested view"})]}),"nested"===s&&o?(0,r.jsx)("div",{className:"space-y-2",children:i.map((e,t)=>(0,r.jsx)(T,{node:e},e.span.id||e.span.span_id||t))}):(0,r.jsx)("div",{className:"space-y-2",children:c.map((e,t)=>(0,r.jsx)(D,{span:e,index:t},e.id||e.span_id||t))})]}),o&&"nested"===s&&(0,r.jsxs)("div",{className:"text-xs text-secondary flex items-center gap-4 pt-2 border-t border-surface",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-2 h-2 rounded-full bg-cyan-400"}),"Parallel execution"]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"border-l-2 border-cyan-500/50 h-3"}),"Child of parent span"]})]})]})}function O(){var e,t,s,a,n,l,c,d,x,u;let{selectedTrace:m,selectedTraceId:h,isLoading:g}=i();if(!h)return(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-slate-400",children:(0,r.jsx)("p",{children:"Select a trace to view details"})});if(g&&!m)return(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-slate-400",children:(0,r.jsx)("p",{children:"Loading trace details..."})});if(!m)return(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-red-400",children:(0,r.jsx)("p",{children:"Trace not found"})});let f="completed"===m.status?"success":"error"===m.status?"error":"warning",j=(null===(e=m.spans)||void 0===e?void 0:e.filter(e=>"running"===e.status))||[],v=(null===(t=m.spans)||void 0===t?void 0:t.filter(e=>"completed"===e.status))||[],N=(null===(s=m.spans)||void 0===s?void 0:s.filter(e=>"completed"===e.status&&"tool_call"===e.span_type&&e.tool_output))||[],y=(null===(a=m.spans)||void 0===a?void 0:a.length)||0,b=e=>{if(!e)return"";if("string"==typeof e)return e.slice(0,1e3)+(e.length>1e3?"...":"");try{let t=JSON.stringify(e,null,2);return t.slice(0,1e3)+(t.length>1e3?"...":"")}catch(t){return String(e).slice(0,1e3)}};return(0,r.jsxs)("div",{className:"h-full overflow-y-auto p-4",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)(p,{variant:f,children:m.status}),(0,r.jsx)("span",{className:"text-xs text-slate-400 font-mono cursor-pointer hover:text-cyan-400",onClick:()=>navigator.clipboard.writeText(m.id),title:"Click to copy",children:m.id})]}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-white mb-2",children:m.input_prompt}),(0,r.jsxs)("div",{className:"flex gap-4 text-sm text-slate-400",children:[(0,r.jsxs)("span",{children:["Started: ",(0,o.p6)(m.started_at)]}),m.total_duration_ms>0&&(0,r.jsxs)("span",{children:["Duration: ",(0,o.LU)(m.total_duration_ms)]}),m.total_tokens>0&&(0,r.jsxs)("span",{children:["Tokens: ",m.total_tokens]})]})]}),m.operational_summary&&(0,r.jsxs)("details",{className:"mb-6",children:[(0,r.jsxs)("summary",{className:"text-sm font-medium text-slate-400 cursor-pointer hover:text-cyan-400 flex items-center gap-2",children:[(0,r.jsx)("span",{children:"Operational Summary"}),(null===(n=m.operational_summary.errors)||void 0===n?void 0:n.length)>0&&(0,r.jsxs)(p,{variant:"error",children:[m.operational_summary.errors.length," errors"]}),(null===(l=m.operational_summary.warnings)||void 0===l?void 0:l.length)>0&&(0,r.jsxs)(p,{variant:"warning",children:[m.operational_summary.warnings.length," warnings"]})]}),(0,r.jsxs)("div",{className:"mt-3 bg-slate-700 rounded-lg p-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-medium text-slate-400 uppercase mb-2",children:"Searches"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-cyan-400",children:m.operational_summary.google_searches||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Google Searches"})]}),(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:m.operational_summary.google_searches_cached||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Google (Cached)"})]}),(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-cyan-400",children:m.operational_summary.zap_searches||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Zap Searches"})]}),(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:m.operational_summary.zap_searches_cached||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Zap (Cached)"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-medium text-slate-400 uppercase mb-2",children:"Page Scrapes"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-cyan-400",children:m.operational_summary.page_scrapes||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Pages Scraped"})]}),(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:m.operational_summary.page_scrapes_cached||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Cached"})]})]})]}),(m.operational_summary.prices_extracted>0||m.operational_summary.prices_failed>0)&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-medium text-slate-400 uppercase mb-2",children:"Extractions"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:m.operational_summary.prices_extracted||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Prices Found"})]}),(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-red-400",children:m.operational_summary.prices_failed||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Prices Failed"})]}),(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-emerald-400",children:m.operational_summary.contacts_extracted||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Contacts Found"})]}),(0,r.jsxs)("div",{className:"bg-slate-800 rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-red-400",children:m.operational_summary.contacts_failed||0}),(0,r.jsx)("div",{className:"text-xs text-slate-400",children:"Contacts Failed"})]})]})]}),(null===(c=m.operational_summary.errors)||void 0===c?void 0:c.length)>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-xs font-medium text-red-400 uppercase mb-2",children:["Errors (",m.operational_summary.errors.length,")"]}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:m.operational_summary.errors.map((e,t)=>(0,r.jsx)("div",{className:"bg-error/10 text-red-400 text-xs p-2 rounded font-mono",children:e},t))})]}),(null===(d=m.operational_summary.warnings)||void 0===d?void 0:d.length)>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-xs font-medium text-amber-400 uppercase mb-2",children:["Warnings (",m.operational_summary.warnings.length,")"]}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:m.operational_summary.warnings.map((e,t)=>(0,r.jsx)("div",{className:"bg-warning/10 text-amber-400 text-xs p-2 rounded font-mono",children:e},t))})]})]})]}),"running"===m.status&&(0,r.jsxs)("div",{className:"mb-6 p-4 bg-warning/10 border border-warning/30 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-warning border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-amber-400 font-medium",children:"Search in progress..."})]}),j.length>0&&(0,r.jsxs)("div",{className:"text-sm text-slate-400",children:[(0,r.jsxs)("p",{children:["Current: ",(null===(x=j[0])||void 0===x?void 0:x.name)||"Processing"]}),(null===(u=j[0])||void 0===u?void 0:u.tool_input)!=null&&"object"==typeof j[0].tool_input&&(0,r.jsxs)("p",{className:"text-xs mt-1",children:[JSON.stringify(j[0].tool_input).slice(0,100),"..."]})]}),y>0&&(0,r.jsxs)("div",{className:"mt-2 text-xs text-slate-400",children:["Steps completed: ",v.length," / ",y]}),N.length>0&&(0,r.jsxs)("div",{className:"mt-4 border-t border-warning/20 pt-3",children:[(0,r.jsx)("p",{className:"text-xs text-slate-400 mb-2",children:"Results so far:"}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:N.map(e=>(0,r.jsxs)("div",{className:"bg-background/50 rounded p-2 text-xs",children:[(0,r.jsx)("p",{className:"text-cyan-400 font-medium mb-1",children:e.name}),(0,r.jsx)("pre",{className:"text-slate-400 whitespace-pre-wrap font-mono text-[10px] max-h-32 overflow-y-auto",children:b(e.tool_output)})]},e.id))})]})]}),m.error&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-red-400 mb-2",children:"Error"}),(0,r.jsx)("div",{className:"bg-error/10 border border-error/30 rounded-lg p-4 text-sm text-red-400",children:m.error})]}),(0,r.jsx)(S,{}),m.spans&&m.spans.length>0&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(E,{spans:m.spans})}),m.final_output&&(0,r.jsxs)("details",{className:"mb-6",children:[(0,r.jsx)("summary",{className:"text-sm font-medium text-slate-400 mb-2 cursor-pointer hover:text-cyan-400",children:"Raw Output"}),(0,r.jsx)("div",{className:"bg-background rounded-lg p-4 text-sm whitespace-pre-wrap mt-2",children:m.final_output})]})]})}function I(){let{query:e,setQuery:t,isSearching:s,runSearch:n}=f(),[l,c]=(0,a.useState)(e);return(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l.trim()&&(t(l),n(l))},className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Search for products (e.g., iPhone 15, Samsung TV...)",className:"flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500",disabled:s}),(0,r.jsx)(b.z,{type:"submit",disabled:s||!l.trim(),children:s?"Searching...":"Search"})]})}var L=s(3425);let P={DEBUG:"text-slate-400",INFO:"text-cyan-400",WARN:"text-amber-400",WARNING:"text-amber-400",ERROR:"text-red-400"},R={DEBUG:"bg-slate-500/20",INFO:"bg-cyan-500/20",WARN:"bg-amber-500/20",WARNING:"bg-amber-500/20",ERROR:"bg-red-500/20"};function U(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(!0),[l,c]=(0,a.useState)(null),[i,o]=(0,a.useState)(""),[d,x]=(0,a.useState)(""),[u,m]=(0,a.useState)("app"),[p,h]=(0,a.useState)(!0),[g,f]=(0,a.useState)(0),[j,v]=(0,a.useState)(!1),[N,y]=(0,a.useState)(new Set),b=(0,a.useRef)(null),w=(0,a.useCallback)(async()=>{try{let e=new URLSearchParams({limit:"200",file:u});i&&e.append("level",i),d&&e.append("search",d);let s=await fetch("".concat("http://localhost:8000","/api/logs?").concat(e));if(!s.ok)throw Error("HTTP ".concat(s.status));let r=await s.json();t(r.logs),f(r.total),v(r.has_more),c(null)}catch(e){c(e instanceof Error?e.message:"Failed to fetch logs")}finally{n(!1)}},[i,d,u]);(0,a.useEffect)(()=>{if(w(),p){let e=setInterval(w,3e3);return()=>clearInterval(e)}},[w,p]);let _=e=>{y(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},S=e=>{try{return new Date(e).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(t){return e}};return(0,r.jsxs)("div",{className:"flex flex-col h-full bg-slate-900 rounded-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 border-b border-slate-700 bg-slate-800/50",children:[(0,r.jsx)("h3",{className:"font-medium text-white",children:"Logs"}),(0,r.jsxs)("div",{className:"flex rounded-lg overflow-hidden border border-slate-600",children:[(0,r.jsx)("button",{onClick:()=>m("app"),className:"px-3 py-1 text-xs font-medium transition-colors ".concat("app"===u?"bg-cyan-500/20 text-cyan-400":"text-slate-400 hover:bg-slate-700"),children:"App"}),(0,r.jsx)("button",{onClick:()=>m("error"),className:"px-3 py-1 text-xs font-medium transition-colors ".concat("error"===u?"bg-red-500/20 text-red-400":"text-slate-400 hover:bg-slate-700"),children:"Errors"})]}),(0,r.jsxs)("select",{value:i,onChange:e=>o(e.target.value),className:"px-2 py-1 text-xs bg-slate-800 border border-slate-600 rounded-lg text-slate-300 focus:border-cyan-500 outline-none",children:[(0,r.jsx)("option",{value:"",children:"All levels"}),(0,r.jsx)("option",{value:"DEBUG",children:"DEBUG"}),(0,r.jsx)("option",{value:"INFO",children:"INFO"}),(0,r.jsx)("option",{value:"WARN",children:"WARN"}),(0,r.jsx)("option",{value:"ERROR",children:"ERROR"})]}),(0,r.jsx)("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"Search logs...",className:"flex-1 max-w-xs px-3 py-1 text-xs bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:border-cyan-500 outline-none"}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-xs text-slate-400 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:p,onChange:e=>h(e.target.checked),className:"w-3 h-3 rounded border-slate-500 bg-slate-700 checked:bg-cyan-500 checked:border-cyan-500"}),"Auto-refresh"]}),(0,r.jsx)("button",{onClick:w,disabled:s,className:"p-1.5 text-slate-400 hover:text-white rounded transition-colors",title:"Refresh",children:(0,r.jsx)("svg",{className:"w-4 h-4 ".concat(s?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,r.jsxs)("span",{className:"text-xs text-slate-500",children:[g," entries"]})]}),(0,r.jsxs)("div",{ref:b,className:"flex-1 overflow-y-auto font-mono text-xs",children:[l?(0,r.jsxs)("div",{className:"p-4 text-red-400",children:["Error loading logs: ",l]}):0===e.length?(0,r.jsx)("div",{className:"p-4 text-slate-500 text-center",children:s?"Loading logs...":"No logs found"}):(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"sticky top-0 bg-slate-800 text-slate-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-2 py-1.5 text-left w-16",children:"Time"}),(0,r.jsx)("th",{className:"px-2 py-1.5 text-left w-16",children:"Level"}),(0,r.jsx)("th",{className:"px-2 py-1.5 text-left w-32",children:"Event"}),(0,r.jsx)("th",{className:"px-2 py-1.5 text-left",children:"Message / Data"})]})}),(0,r.jsx)("tbody",{children:e.map((e,t)=>{let s=N.has(t),a=Object.keys(e.data).length>0;return(0,r.jsxs)("tr",{onClick:()=>a&&_(t),className:"border-b border-slate-800 hover:bg-slate-800/50\n                              ".concat(a?"cursor-pointer":"","\n                              ").concat(s?"bg-slate-800/30":""),children:[(0,r.jsx)("td",{className:"px-2 py-1 text-slate-500 whitespace-nowrap align-top",children:(0,r.jsx)("span",{title:e.timestamp,children:S(e.timestamp)})}),(0,r.jsx)("td",{className:"px-2 py-1 align-top",children:(0,r.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium\n                                  ".concat(P[e.level]||"text-slate-400","\n                                  ").concat(R[e.level]||"bg-slate-500/20"),children:e.level})}),(0,r.jsx)("td",{className:"px-2 py-1 text-cyan-300 align-top truncate max-w-[8rem]",children:e.event}),(0,r.jsx)("td",{className:"px-2 py-1 text-slate-300 align-top",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[a&&(0,r.jsx)("span",{className:"text-slate-500 select-none",children:s?"â–¼":"â–¶"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[e.message&&(0,r.jsx)("div",{className:"truncate",children:e.message}),s&&a&&(0,r.jsx)("pre",{className:"mt-2 p-2 bg-slate-900 rounded text-slate-400 overflow-x-auto",children:JSON.stringify(e.data,null,2)})]})]})})]},t)})})]}),j&&(0,r.jsx)("div",{className:"p-2 text-center text-slate-500 text-xs",children:"Showing first 200 entries. Use filters to narrow down."})]})]})}function z(){!function(){let e=(0,a.useRef)(null),t=(0,a.useRef)(),{setConnectionStatus:s,addTrace:r,updateTrace:n,fetchTraces:l,fetchTraceDetail:c,selectedTraceId:o}=i(),d=(0,a.useCallback)(e=>{let t=e.data||{};switch(e.event_type){case"trace_started":r({id:e.trace_id,input_prompt:t.input_prompt||"",status:"running",started_at:t.started_at||new Date().toISOString(),total_tokens:0,total_duration_ms:0,spans:[],operational_summary:t.operational_summary});break;case"trace_ended":n(e.trace_id,{status:t.error?"error":"completed",final_output:t.final_output,error:t.error,ended_at:t.ended_at||new Date().toISOString(),total_duration_ms:t.total_duration_ms,total_tokens:t.total_tokens,operational_summary:t.operational_summary});break;case"span_started":case"span_ended":l(),o&&e.trace_id===o&&c(o);break;default:console.log("Unknown event:",e.event_type)}},[r,n,l,c,o]),x=(0,a.useCallback)(()=>{s("connecting");let r=function(){let e="ws://localhost:8000";if(e)return e;{let e="https:"===window.location.protocol?"wss:":"ws:";return"".concat(e,"//").concat(window.location.host)}}(),a=new WebSocket("".concat(r,"/traces/ws"));e.current=a,a.onopen=()=>{console.log("WebSocket connected"),s("connected")},a.onclose=()=>{console.log("WebSocket disconnected"),s("disconnected"),t.current=setTimeout(x,3e3)},a.onerror=e=>{console.error("WebSocket error:",e),s("disconnected")},a.onmessage=e=>{try{let t=JSON.parse(e.data);d(t)}catch(e){console.error("Failed to parse WebSocket message:",e)}}},[s,d]);(0,a.useEffect)(()=>(x(),()=>{e.current&&e.current.close(),t.current&&clearTimeout(t.current)}),[x]),e.current}();let[e,t]=(0,a.useState)("traces");return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-slate-900 text-white",children:[(0,r.jsx)(x,{}),(0,r.jsxs)("main",{className:"flex-1 flex flex-col p-4 gap-4",children:[(0,r.jsx)("section",{className:"bg-slate-800 rounded-lg p-4",children:(0,r.jsx)(I,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-1 bg-slate-800 rounded-lg p-1 w-fit",children:[(0,r.jsx)("button",{onClick:()=>t("traces"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("traces"===e?"bg-cyan-500/20 text-cyan-400":"text-slate-400 hover:text-white hover:bg-slate-700"),children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Traces"]})}),(0,r.jsx)("button",{onClick:()=>t("logs"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("logs"===e?"bg-cyan-500/20 text-cyan-400":"text-slate-400 hover:text-white hover:bg-slate-700"),children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Logs"]})})]}),"traces"===e?(0,r.jsxs)("div",{className:"flex-1 flex gap-4 min-h-0",children:[(0,r.jsxs)("aside",{className:"w-80 bg-slate-800 rounded-lg overflow-hidden flex flex-col",children:[(0,r.jsx)("div",{className:"px-4 py-3 border-b border-slate-700",children:(0,r.jsx)("h2",{className:"font-medium text-white",children:"Recent Traces"})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"p-4 text-center text-slate-400",children:"Loading..."}),children:(0,r.jsx)(g,{})})})]}),(0,r.jsx)("section",{className:"flex-1 bg-slate-800 rounded-lg overflow-hidden",children:(0,r.jsx)(O,{})})]}):(0,r.jsx)("div",{className:"flex-1 min-h-0",children:(0,r.jsx)(U,{})})]}),(0,r.jsx)(L.T,{})]})}},3425:function(e,t,s){"use strict";s.d(t,{T:function(){return o}});var r=s(7437),a=s(7850),n=s(2265),l=s(3448);function c(e){let{isOpen:t,onClose:s,title:a,children:c,footer:i,className:o}=e;return((0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,s]),t)?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:s,children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/70"}),(0,r.jsxs)("div",{className:(0,l.cn)("relative bg-surface rounded-xl max-w-2xl w-[90%] max-h-[80vh] overflow-hidden","shadow-2xl",o),onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-surface-hover",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:a}),(0,r.jsx)("button",{onClick:s,className:"text-secondary hover:text-gray-800 text-2xl leading-none",children:"\xd7"})]}),(0,r.jsx)("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:c}),i&&(0,r.jsx)("div",{className:"flex justify-end gap-3 px-5 py-4 border-t border-surface-hover",children:i})]})]}):null}var i=s(6334);function o(){let{isModalOpen:e,closeModal:t,drafts:s,sentIndices:n,updateDraftMessage:o,updateDraftPhone:d,markAsSent:x,isGenerating:u,error:m}=(0,a.z)(),p=e=>{let t=s[e];window.open(t.wa_link,"_blank"),x(e)},h=async e=>{let t=s[e];await navigator.clipboard.writeText(t.wa_link)};return(0,r.jsx)(c,{isOpen:e,onClose:t,title:"Review Negotiation Messages",footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.z,{variant:"success",onClick:()=>{s.forEach((e,t)=>{n.has(t)||setTimeout(()=>p(t),500*t)})},children:"Send All via WhatsApp"}),(0,r.jsx)(i.z,{variant:"secondary",onClick:t,children:"Cancel"})]}),children:u?(0,r.jsx)("p",{className:"text-secondary text-center py-8",children:"Generating drafts..."}):m?(0,r.jsx)("p",{className:"text-error text-center py-8",children:m}):(0,r.jsx)("div",{className:"space-y-4",children:s.map((e,t)=>(0,r.jsxs)("div",{className:(0,l.cn)("bg-background rounded-lg p-4",n.has(t)&&"opacity-60 border-2 border-success"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:!0,readOnly:!0,className:"w-4 h-4"}),(0,r.jsx)("strong",{className:"text-primary",children:e.seller_name})]}),(0,r.jsxs)("p",{className:"text-sm text-secondary mb-3",children:["Product: ",e.product_name]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-xs text-secondary mb-1",children:"Phone Number:"}),(0,r.jsx)("input",{type:"text",value:e.phone_number,onChange:e=>d(t,e.target.value),className:"w-48 px-3 py-1.5 bg-surface border border-surface-hover rounded text-gray-800 text-sm focus:outline-none focus:border-primary"})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-xs text-secondary mb-1",children:"Message:"}),(0,r.jsx)("textarea",{value:e.message,onChange:e=>o(t,e.target.value),className:"w-full min-h-[80px] px-3 py-2 bg-surface border border-surface-hover rounded text-gray-800 text-sm resize-y focus:outline-none focus:border-primary"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(i.z,{variant:"success",size:"sm",onClick:()=>p(t),disabled:n.has(t),children:n.has(t)?"âœ“ Opened":"\uD83D\uDCF1 Send via WhatsApp"}),(0,r.jsx)(i.z,{variant:"secondary",size:"sm",onClick:()=>h(t),children:"\uD83D\uDD17 Copy Link"})]})]},t))})})}},6334:function(e,t,s){"use strict";s.d(t,{z:function(){return i}});var r=s(7437),a=s(3448),n=s(2265);let l={primary:"bg-primary text-white hover:bg-primary/80",secondary:"bg-surface text-secondary hover:bg-surface-hover",success:"bg-success text-white hover:bg-success/80",danger:"bg-error text-white hover:bg-error/80",ghost:"bg-transparent text-secondary hover:bg-surface"},c={sm:"px-2 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},i=(0,n.forwardRef)((e,t)=>{let{variant:s="primary",size:n="md",className:i,disabled:o,...d}=e;return(0,r.jsx)("button",{ref:t,className:(0,a.cn)("inline-flex items-center justify-center rounded font-medium transition-colors","focus:outline-none focus:ring-2 focus:ring-primary/50","disabled:opacity-50 disabled:cursor-not-allowed",l[s],c[n],i),disabled:o,...d})});i.displayName="Button"},1837:function(e,t,s){"use strict";s.d(t,{h:function(){return a}});class r{async fetch(e,t){let s=await fetch("".concat(this.baseUrl).concat(e),{...t,headers:{"Content-Type":"application/json",...null==t?void 0:t.headers}});if(!s.ok)throw Error("API error: ".concat(s.status," ").concat(s.statusText));return s.json()}async getTraces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return(await this.fetch("/traces/?limit=".concat(e))).traces}async getTrace(e){return this.fetch("/traces/".concat(e))}async deleteTrace(e){await this.fetch("/traces/".concat(e),{method:"DELETE"})}async runQuery(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"research";return this.fetch("/agent/run",{method:"POST",body:JSON.stringify({query:e,agent:t})})}async generateDrafts(e){return this.fetch("/agent/generate-drafts",{method:"POST",body:JSON.stringify(e)})}async lookupContacts(e){return(await this.fetch("/api/sellers/contacts",{method:"POST",body:JSON.stringify({domains:e})})).contacts}async getSellers(){return(await this.fetch("/api/sellers/")).sellers}async runDiscovery(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IL";return this.fetch("/agent/run",{method:"POST",body:JSON.stringify({query:e,agent:"discovery",country:t})})}async runDiscoveryRefinement(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IL",s=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return this.fetch("/agent/run",{method:"POST",body:JSON.stringify({query:e,agent:"discovery",country:t,conversation_history:s,session_id:r,parent_trace_id:a})})}async getCountry(){return this.fetch("/api/geo/country")}async startPriceSearch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IL";return this.fetch("/api/shopping-list/search-prices",{method:"POST",body:JSON.stringify({items:e,country:t})})}async getSearchStatus(e){return this.fetch("/api/shopping-list/search-status/".concat(e))}constructor(e="http://localhost:8000"){this.baseUrl=e}}let a=new r},3448:function(e,t,s){"use strict";s.d(t,{$G:function(){return o},LU:function(){return c},T4:function(){return i},cn:function(){return n},kU:function(){return d},p6:function(){return l}});var r=s(1994),a=s(3335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,r.W)(t))}function l(e){return e?new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function c(e){return e<1e3?"".concat(e,"ms"):"".concat((e/1e3).toFixed(1),"s")}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ILS";return"".concat(e.toLocaleString()," ").concat(t)}function o(e,t){return e?e.length<=t?e:e.slice(0,t-3)+"...":""}function d(e,t){let s=e.replace(/[^0-9]/g,""),r="https://wa.me/".concat(s);return t&&(r+="?text=".concat(encodeURIComponent(t))),r}},7850:function(e,t,s){"use strict";s.d(t,{z:function(){return l}});var r=s(9625),a=s(1837),n=s(3448);let l=(0,r.Ue)((e,t)=>({isModalOpen:!1,isGenerating:!1,drafts:[],sentIndices:new Set,error:null,openModal:()=>e({isModalOpen:!0}),closeModal:()=>e({isModalOpen:!1,drafts:[],sentIndices:new Set,error:null}),updateDraftMessage:(t,s)=>e(e=>{let r=[...e.drafts];return r[t]&&(r[t]={...r[t],message:s,wa_link:(0,n.kU)(r[t].phone_number,s)}),{drafts:r}}),updateDraftPhone:(t,s)=>e(e=>{let r=[...e.drafts];return r[t]&&(r[t]={...r[t],phone_number:s,wa_link:(0,n.kU)(s,r[t].message)}),{drafts:r}}),markAsSent:t=>e(e=>({sentIndices:new Set([...e.sentIndices,t])})),clearDrafts:()=>e({drafts:[],sentIndices:new Set,error:null}),generateDrafts:async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"he";e({isGenerating:!0,error:null});try{let r=await a.h.generateDrafts({sellers:t,language:s});e({drafts:r.drafts,isGenerating:!1,isModalOpen:!0})}catch(t){e({error:t instanceof Error?t.message:"Failed to generate drafts",isGenerating:!1})}}}))}},function(e){e.O(0,[972,929,971,117,744],function(){return e(e.s=710)}),_N_E=e.O()}]);