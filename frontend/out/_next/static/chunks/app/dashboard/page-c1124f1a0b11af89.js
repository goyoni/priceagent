(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{710:function(e,s,t){Promise.resolve().then(t.bind(t,5415))},5415:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return J}});var r=t(7437),a=t(7648),n=t(9625),c=t(1837);let l=(0,n.Ue)((e,s)=>({traces:[],selectedTraceId:null,selectedTrace:null,connectionStatus:"connecting",isLoading:!1,error:null,setTraces:s=>e({traces:s||[]}),selectTrace:t=>{e({selectedTraceId:t}),t?s().fetchTraceDetail(t):e({selectedTrace:null})},setSelectedTraceDetail:s=>e({selectedTrace:s}),updateTrace:(s,t)=>e(e=>{var r;return{traces:(e.traces||[]).map(e=>e.id===s?{...e,...t}:e),selectedTrace:(null===(r=e.selectedTrace)||void 0===r?void 0:r.id)===s?{...e.selectedTrace,...t}:e.selectedTrace}}),addTrace:s=>e(e=>({traces:[s,...e.traces||[]].slice(0,50)})),deleteTrace:async s=>{try{await c.h.deleteTrace(s),e(e=>{var t;return{traces:(e.traces||[]).filter(e=>e.id!==s),selectedTraceId:e.selectedTraceId===s?null:e.selectedTraceId,selectedTrace:(null===(t=e.selectedTrace)||void 0===t?void 0:t.id)===s?null:e.selectedTrace}})}catch(e){console.error("Failed to delete trace:",e)}},setConnectionStatus:s=>e({connectionStatus:s}),setLoading:s=>e({isLoading:s}),setError:s=>e({error:s}),fetchTraces:async()=>{e({isLoading:!0,error:null});try{let s=await c.h.getTraces();e({traces:s||[],isLoading:!1})}catch(s){e({error:s instanceof Error?s.message:"Failed to fetch traces",isLoading:!1})}},fetchTraceDetail:async s=>{e({isLoading:!0,error:null});try{let t=await c.h.getTrace(s);e({selectedTrace:t,isLoading:!1})}catch(s){e({error:s instanceof Error?s.message:"Failed to fetch trace",isLoading:!1})}}}));var i=t(1994),o=t(3335);function d(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,o.m6)((0,i.W)(s))}function u(e){return e?new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function x(e){return e<1e3?"".concat(e,"ms"):"".concat((e/1e3).toFixed(1),"s")}function m(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ILS";return"".concat(e.toLocaleString()," ").concat(s)}function p(e,s){let t=e.replace(/[^0-9]/g,""),r="https://wa.me/".concat(t);return s&&(r+="?text=".concat(encodeURIComponent(s))),r}function h(){let e={connecting:{color:"bg-warning",text:"Connecting..."},connected:{color:"bg-success",text:"Connected"},disconnected:{color:"bg-error",text:"Disconnected"}}[l(e=>e.connectionStatus)];return(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-secondary",children:[(0,r.jsx)("span",{className:d("w-2 h-2 rounded-full animate-pulse",e.color)}),(0,r.jsx)("span",{children:e.text})]})}function g(){return(0,r.jsxs)("header",{className:"h-14 bg-surface border-b border-surface-hover px-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsx)("h1",{className:"text-lg font-semibold",children:"Agent Dashboard"}),(0,r.jsx)("nav",{className:"flex items-center gap-4",children:(0,r.jsx)(a.default,{href:"/sellers",className:"text-sm text-muted hover:text-foreground transition-colors",children:"Sellers DB"})})]}),(0,r.jsx)(h,{})]})}var f=t(2265);let j={default:"bg-surface text-secondary",success:"bg-success/20 text-success",warning:"bg-warning/20 text-warning",error:"bg-error/20 text-error",info:"bg-primary/20 text-primary",secondary:"bg-secondary/20 text-secondary",primary:"bg-primary/30 text-primary"};function v(e){let{variant:s="default",children:t,className:a}=e;return(0,r.jsx)("span",{className:d("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",j[s],a),children:t})}function y(e){var s,t,a;let{trace:n,isSelected:c,onClick:l,onDelete:i}=e,o="completed"===n.status?"success":"error"===n.status?"error":"warning",x=(null===(s=n.spans)||void 0===s?void 0:s.filter(e=>"running"===e.status))||[];return(0,r.jsxs)("div",{className:d("p-3 rounded-lg cursor-pointer transition-colors relative group","hover:bg-surface-hover",c?"bg-surface-hover border border-primary/50":"bg-surface","running"===n.status&&"border-l-2 border-l-warning"),onClick:l,children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),confirm("Delete this trace?")&&i()},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-error/20 rounded text-error text-xs",title:"Delete trace",children:"‚úï"}),(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2 pr-6",children:[(0,r.jsx)(v,{variant:o,children:"running"===n.status?(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"animate-pulse",children:"‚óè"})," Running"]}):n.status}),(0,r.jsx)("span",{className:"text-xs text-secondary",children:u(n.started_at)})]}),(0,r.jsx)("p",{className:"text-sm text-white mb-2",children:(a=n.input_prompt)?a.length<=80?a:a.slice(0,77)+"...":""}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-xs text-secondary",children:[(0,r.jsx)("span",{className:"font-mono",children:n.id.substring(0,8)}),"running"===n.status&&x.length>0&&(0,r.jsx)("span",{className:"text-warning animate-pulse",children:(null===(t=x[0])||void 0===t?void 0:t.name)||"Processing..."}),"completed"===n.status&&n.total_tokens>0&&(0,r.jsxs)("span",{children:[n.total_tokens," tokens"]})]})]})}function b(){let{traces:e,selectedTraceId:s,selectTrace:t,fetchTraces:a,fetchTraceDetail:n,deleteTrace:c,isLoading:i,error:o}=l(),d=(e||[]).some(e=>"running"===e.status);return((0,f.useEffect)(()=>{a();let e=setInterval(a,d?2e3:5e3);return()=>clearInterval(e)},[a,d]),(0,f.useEffect)(()=>{if(!s||!e)return;let t=e.find(e=>e.id===s);if((null==t?void 0:t.status)!=="running")return;let r=setInterval(()=>{n(s)},2e3);return()=>clearInterval(r)},[s,e,n]),o)?(0,r.jsxs)("div",{className:"p-4 text-center text-error",children:[(0,r.jsx)("p",{children:"Error loading traces"}),(0,r.jsx)("p",{className:"text-sm",children:o})]}):i&&(!e||0===e.length)?(0,r.jsx)("div",{className:"p-4 text-center text-secondary",children:(0,r.jsx)("p",{children:"Loading traces..."})}):e&&0!==e.length?(0,r.jsx)("div",{className:"space-y-2 p-2",children:e.map(e=>(0,r.jsx)(y,{trace:e,isSelected:e.id===s,onClick:()=>t(e.id),onDelete:()=>c(e.id)},e.id))}):(0,r.jsxs)("div",{className:"p-8 text-center text-secondary",children:[(0,r.jsx)("p",{className:"text-lg mb-2",children:"No traces yet"}),(0,r.jsx)("p",{className:"text-sm",children:"Run a search to see traces here"})]})}let N=(0,n.Ue)((e,s)=>({query:"",isSearching:!1,currentTraceId:null,results:[],bundles:[],selectedSellers:[],error:null,setQuery:s=>e({query:s}),setResults:s=>e({results:s}),setBundles:s=>e({bundles:s}),toggleSellerSelection:s=>e(e=>{let t="".concat(s.seller_name,":").concat(s.phone_number);return e.selectedSellers.some(e=>e.id===t)?{selectedSellers:e.selectedSellers.filter(e=>e.id!==t)}:{selectedSellers:[...e.selectedSellers,{...s,id:t}]}}),isSellerSelected:(e,t)=>{let r="".concat(e,":").concat(t);return s().selectedSellers.some(e=>e.id===r)},clearSelection:()=>e({selectedSellers:[]}),setError:s=>e({error:s}),runSearch:async s=>{e({isSearching:!0,error:null,query:s});try{let t=await c.h.runQuery(s,"research");e({currentTraceId:t.trace_id,isSearching:!1})}catch(s){e({error:s instanceof Error?s.message:"Search failed",isSearching:!1})}}})),w=(0,n.Ue)((e,s)=>({isModalOpen:!1,isGenerating:!1,drafts:[],sentIndices:new Set,error:null,openModal:()=>e({isModalOpen:!0}),closeModal:()=>e({isModalOpen:!1,drafts:[],sentIndices:new Set,error:null}),updateDraftMessage:(s,t)=>e(e=>{let r=[...e.drafts];return r[s]&&(r[s]={...r[s],message:t,wa_link:p(r[s].phone_number,t)}),{drafts:r}}),updateDraftPhone:(s,t)=>e(e=>{let r=[...e.drafts];return r[s]&&(r[s]={...r[s],phone_number:t,wa_link:p(t,r[s].message)}),{drafts:r}}),markAsSent:s=>e(e=>({sentIndices:new Set([...e.sentIndices,s])})),clearDrafts:()=>e({drafts:[],sentIndices:new Set,error:null}),generateDrafts:async function(s){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"he";e({isGenerating:!0,error:null});try{let r=await c.h.generateDrafts({sellers:s,language:t});e({drafts:r.drafts,isGenerating:!1,isModalOpen:!0})}catch(s){e({error:s instanceof Error?s.message:"Failed to generate drafts",isGenerating:!1})}}}));function _(e){let{bundles:s}=e,{toggleSellerSelection:t,isSellerSelected:a}=N(),[n,c]=(0,f.useState)("products"),l=(null==s?void 0:s.filter(e=>e.productCount>=1))||[];if(0===l.length)return null;let i=[...l].sort((e,s)=>{var t,r,a,c;return"price"===n?(null!==(t=e.totalPrice)&&void 0!==t?t:1/0)-(null!==(r=s.totalPrice)&&void 0!==r?r:1/0):s.productCount!==e.productCount?s.productCount-e.productCount:(null!==(a=e.totalPrice)&&void 0!==a?a:1/0)-(null!==(c=s.totalPrice)&&void 0!==c?c:1/0)}).slice(0,10),o=e=>{if(!e.contact)return;let s=e.products&&e.products.length>0?e.products.map(e=>e.name).join(", "):"Bundle";t({seller_name:e.storeName,phone_number:e.contact,product_name:s,listed_price:e.totalPrice||0})};return(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-secondary",children:["Bundle Opportunities (",i.length," stores)"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-secondary",children:"Sort by:"}),(0,r.jsxs)("select",{value:n,onChange:e=>c(e.target.value),className:"text-xs bg-surface border border-surface-hover rounded px-2 py-1 text-primary",children:[(0,r.jsx)("option",{value:"products",children:"Most Products"}),(0,r.jsx)("option",{value:"price",children:"Lowest Price"})]})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-surface-hover text-left text-secondary",children:[(0,r.jsx)("th",{className:"px-3 py-2 w-10",children:"#"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Store"}),(0,r.jsx)("th",{className:"px-3 py-2 w-20",children:"Rating"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Products"}),(0,r.jsxs)("th",{className:"px-3 py-2 w-28 cursor-pointer hover:text-primary",onClick:()=>c("price"),children:["Total Price ","price"===n&&"‚Üë"]}),(0,r.jsx)("th",{className:"px-3 py-2 w-28",children:"Contact"})]})}),(0,r.jsx)("tbody",{children:i.map((e,s)=>(0,r.jsxs)("tr",{className:"border-b border-surface-hover hover:bg-surface-hover/50",children:[(0,r.jsx)("td",{className:"px-3 py-2 text-secondary",children:s+1}),(0,r.jsx)("td",{className:"px-3 py-2 font-medium",children:e.storeName}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.rating?(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-warning/20 text-warning text-xs",children:["‚òÖ ",e.rating]}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsxs)("div",{className:"text-xs",children:[(0,r.jsxs)("span",{className:"text-primary",children:[e.productCount,"/",e.totalProducts]}),e.products&&e.products.length>0&&(0,r.jsx)("ul",{className:"mt-1 space-y-1",children:e.products.map((e,s)=>(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-secondary",children:[e.name,": ",m(e.price,e.currency)]}),e.url&&(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"‚Üí"})]},s))})]})}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.totalPrice?(0,r.jsx)("span",{className:"text-success font-medium",children:m(e.totalPrice,"ILS")}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.contact?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:a(e.storeName,e.contact),onChange:()=>o(e),className:"w-4 h-4 cursor-pointer"}),(0,r.jsx)("a",{href:p(e.contact),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-1 rounded bg-[#25D366] text-white text-xs hover:bg-[#128C7E]",children:"\uD83D\uDCAC"})]}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})})]},e.storeName))})]})})]})}function S(e){let{result:s,productName:t}=e,{toggleSellerSelection:a,isSellerSelected:n}=N();return(0,r.jsxs)("tr",{className:"border-b border-surface-hover hover:bg-surface-hover/50",children:[(0,r.jsx)("td",{className:"px-3 py-2 text-secondary",children:s.index}),(0,r.jsx)("td",{className:"px-3 py-2 font-medium",children:s.seller}),(0,r.jsx)("td",{className:"px-3 py-2",children:s.rating?(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-warning/20 text-warning text-xs",children:["‚òÖ ",s.rating]}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:s.price?(0,r.jsx)("span",{className:"text-success font-medium",children:m(s.price,s.currency)}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:s.url?(0,r.jsx)("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline text-sm",children:"View ‚Üí"}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})}),(0,r.jsx)("td",{className:"px-3 py-2",children:s.phone?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:n(s.seller,s.phone),onChange:()=>{s.phone&&a({seller_name:s.seller,phone_number:s.phone,product_name:t,listed_price:s.price||0})},className:"w-4 h-4 cursor-pointer"}),(0,r.jsx)("a",{href:p(s.phone),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-1 rounded bg-[#25D366] text-white text-xs hover:bg-[#128C7E]",children:"\uD83D\uDCAC"})]}):(0,r.jsx)("span",{className:"text-secondary",children:"-"})})]})}function k(e){let{productName:s,results:t}=e;return t&&0!==t.length?(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-primary mb-2",children:s}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-surface-hover text-left text-secondary",children:[(0,r.jsx)("th",{className:"px-3 py-2 w-10",children:"#"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Seller"}),(0,r.jsx)("th",{className:"px-3 py-2 w-20",children:"Rating"}),(0,r.jsx)("th",{className:"px-3 py-2 w-28",children:"Price"}),(0,r.jsx)("th",{className:"px-3 py-2 w-20",children:"Link"}),(0,r.jsx)("th",{className:"px-3 py-2 w-24",children:"Contact"})]})}),(0,r.jsx)("tbody",{children:t.map(e=>(0,r.jsx)(S,{result:e,productName:s},"".concat(s,"-").concat(e.index)))})]})})]}):null}let C={primary:"bg-primary text-white hover:bg-primary/80",secondary:"bg-surface text-secondary hover:bg-surface-hover",success:"bg-success text-white hover:bg-success/80",danger:"bg-error text-white hover:bg-error/80",ghost:"bg-transparent text-secondary hover:bg-surface"},T={sm:"px-2 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},D=(0,f.forwardRef)((e,s)=>{let{variant:t="primary",size:a="md",className:n,disabled:c,...l}=e;return(0,r.jsx)("button",{ref:s,className:d("inline-flex items-center justify-center rounded font-medium transition-colors","focus:outline-none focus:ring-2 focus:ring-primary/50","disabled:opacity-50 disabled:cursor-not-allowed",C[t],T[a],n),disabled:c,...l})});function I(e){return e.toLowerCase().replace(/[|]/g," ").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}function E(e){return e.toLowerCase().replace(/[^\w]/g,"")}function O(){let{selectedTrace:e}=l(),{selectedSellers:s,clearSelection:t}=N(),{generateDrafts:a,isGenerating:n}=w(),[i,o]=(0,f.useState)({}),[d,u]=(0,f.useState)({}),[x,m]=(0,f.useState)({}),{bundles:p,productSections:h}=(0,f.useMemo)(()=>{if(!(null==e?void 0:e.spans))return{bundles:[],productSections:[]};let s=e.spans.find(e=>e.tool_output);if(!(null==s?void 0:s.tool_output))return{bundles:[],productSections:[]};let t=s.tool_output;return{bundles:function(e){let s;if(!e.match(/=== BUNDLE OPPORTUNITIES \((\d+) stores\) ===/))return[];let t=e.match(RegExp("=== BUNDLE OPPORTUNITIES.*?(?=\\n\\n=== [^B]|$)","s"));if(!t)return[];let r=[],a=/(\d+)\.\s+([^\n]+?)(?:\s+\(Rating:\s*([\d.]+)\/5\))?\n([\s\S]*?)(?=\n\d+\.|$)/g;for(;null!==(s=a.exec(t[0]));){let e;let t=parseInt(s[1]),a=s[2].trim(),n=s[3]?parseFloat(s[3]):void 0,c=s[4],l=c.match(/Offers\s+(\d+)\/(\d+)\s+products/),i=l?parseInt(l[1]):0,o=l?parseInt(l[2]):0,d=[],u=/^\s+-\s+([^:]+):\s+([\d,]+)\s+(\w+)(?:\s*\|\s*(https?:\/\/[^\s]+))?/gm;for(;null!==(e=u.exec(c));)d.push({name:e[1].trim(),price:parseInt(e[2].replace(/,/g,"")),currency:e[3],url:e[4]||void 0});let x=c.match(/Total:\s+([\d,]+)/),m=x?parseInt(x[1].replace(/,/g,"")):void 0,p=c.match(/Contact:\s*(\+?[\d\s-]+)/),h=p?p[1].replace(/[\s-]/g,""):void 0;r.push({index:t,storeName:a,rating:n,productCount:i,totalProducts:o,products:d,totalPrice:m,contact:h})}return r}(t),productSections:function(e){let s;let t=[],r=/\n=== ([^=\n]+) ===\n/g,a=[];for(;null!==(s=r.exec(e));)s[1].includes("BUNDLE OPPORTUNITIES")||a.push({name:s[1].trim(),startIndex:s.index+s[0].length});for(let s=0;s<a.length;s++){let r=a[s].startIndex,n=s+1<a.length?a[s+1].startIndex-a[s+1].name.length-8:e.length,c=function(e){let s;let t=[],r=/(\d+)\.\s+([^\n]+?)(?:\s+\(Rating:\s*([\d.]+)\/5\))?(?:\s+\[([^\]]+)\])?\n([\s\S]*?)(?=\n\d+\.|$)/g;for(;null!==(s=r.exec(e));){let e=parseInt(s[1]),r=s[2].trim(),a=s[3]?parseFloat(s[3]):void 0,n=s[5],c=n.match(/Price:\s*([\d,]+)\s*(\w+)?/),l=c?parseInt(c[1].replace(/,/g,"")):void 0,i=(null==c?void 0:c[2])||"ILS",o=n.match(/URL:\s*(https?:\/\/[^\s]+)/),d=o?o[1]:void 0,u=n.match(/Contact:\s*(\+?[\d\s-]+)/),x=u?u[1].replace(/[\s-]/g,""):void 0;t.push({index:e,seller:r,rating:a,price:l,currency:i,url:d,phone:x})}return t}(e.slice(r,n));t.push({productName:a[s].name,results:c})}return t}(t)}},[e]);(0,f.useEffect)(()=>{c.h.getSellers().then(e=>{let s={},t={},r={};e.forEach(e=>{let a=e.whatsapp_number||e.phone_number;a&&(s[I(e.seller_name)]=a,t[E(e.seller_name)]=a,e.domain&&(r[e.domain]=a))}),u(s),m(t),o(r)}).catch(e=>{console.error("Failed to load sellers:",e)})},[]);let g=(e,s)=>{if(s){let e=function(e){try{let s=new URL(e).hostname.toLowerCase();if(s.startsWith("www.")&&(s=s.slice(4)),s.includes("google.com"))return null;return s}catch(e){return null}}(s);if(e&&i[e])return i[e]}let t=I(e);if(d[t])return d[t];for(let[e,s]of Object.entries(d))if(t.includes(e)||e.includes(t))return s;let r=E(e);if(x[r])return x[r];for(let[e,s]of Object.entries(x))if(r.includes(e)||e.includes(r))return s},j=(0,f.useMemo)(()=>p?p.map(e=>{var s,t;if(e.contact)return e;let r=g(e.storeName,null===(t=e.products)||void 0===t?void 0:null===(s=t[0])||void 0===s?void 0:s.url);return r?{...e,contact:r}:e}):[],[p,i,d,x]),v=(0,f.useMemo)(()=>h?h.map(e=>({...e,results:(e.results||[]).map(e=>{if(e.phone)return e;let s=g(e.seller,e.url);return s?{...e,phone:s}:e})})):[],[h,i,d,x]);return((null==p?void 0:p.length)||0)>0||((null==h?void 0:h.length)||0)>0?(0,r.jsxs)("div",{className:"mt-4",children:[s&&s.length>0&&(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4 p-3 bg-primary/10 rounded-lg",children:[(0,r.jsxs)("span",{className:"text-sm",children:[(0,r.jsx)("strong",{children:s.length})," sellers selected"]}),(0,r.jsx)(D,{size:"sm",onClick:()=>{s&&s.length>0&&a(s)},disabled:n,children:n?"Generating...":"\uD83D\uDCDD Generate Drafts"}),(0,r.jsx)(D,{size:"sm",variant:"ghost",onClick:t,children:"Clear"})]}),j&&j.length>0&&(0,r.jsx)(_,{bundles:j}),v.map(e=>(0,r.jsx)(k,{productName:e.productName,results:e.results},e.productName))]}):null}function P(e){let s=e.name||"";return/^[üì¶üîç‚úÖ‚ö†Ô∏è‚ùåüîÑüéØ‚ÑπÔ∏è]/.test(s)}function L(e){var s;let{span:t}=e,[a,n]=(0,f.useState)(!1),c=t.status||"completed",l=t.name||"",i=(null===(s=l.match(/^[üì¶üîç‚úÖ‚ö†Ô∏è‚ùåüîÑüéØ‚ÑπÔ∏è]/))||void 0===s?void 0:s[0])||"‚Ä¢",o=l.replace(/^[üì¶üîç‚úÖ‚ö†Ô∏è‚ùåüîÑüéØ‚ÑπÔ∏è]\s*/,""),d="running"===c?"text-warning":l.startsWith("‚úÖ")?"text-success":l.startsWith("‚ùå")?"text-error":l.startsWith("‚ö†Ô∏è")?"text-warning":"text-secondary";return(0,r.jsxs)("div",{className:"border-l-2 border-surface-hover pl-3 py-1",children:[(0,r.jsxs)("div",{className:"flex items-start gap-2 cursor-pointer hover:bg-surface-hover rounded px-1 -ml-1",onClick:()=>n(!a),children:[(0,r.jsx)("span",{className:"text-base",children:i}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("span",{className:"text-sm font-medium ".concat(d),children:o}),"running"===c&&(0,r.jsx)("span",{className:"ml-2 text-xs text-warning animate-pulse",children:"running..."})]}),(0,r.jsx)("span",{className:"text-xs text-secondary shrink-0",children:x(t.duration_ms||0)})]}),a&&t.tool_output&&(0,r.jsx)("div",{className:"mt-1 ml-6 text-xs bg-surface rounded p-2 whitespace-pre-wrap font-mono max-h-32 overflow-y-auto",children:"string"==typeof t.tool_output?t.tool_output:JSON.stringify(t.tool_output,null,2)})]})}function R(e){let{span:s,index:t}=e,[a,n]=(0,f.useState)(!1),c=s.type||s.span_type||"function",l=s.status||"completed",i=e=>{if(!e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(s){return String(e)}};return(0,r.jsxs)("div",{className:"bg-surface rounded-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between cursor-pointer hover:bg-surface-hover",onClick:()=>n(!a),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v,{variant:{llm_call:"primary",tool_call:"success",agent_run:"info",handoff:"warning",function:"secondary",agent:"info",tool:"success"}[c]||"secondary",className:"text-xs uppercase",children:c.replace("_"," ")}),(0,r.jsx)("span",{className:"font-medium",children:s.name||"Unknown"}),!0===s.cached&&(0,r.jsx)("span",{className:"text-xs text-secondary",children:"(Cached)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[void 0!==s.input_tokens&&(0,r.jsxs)("span",{className:"text-secondary",children:[s.input_tokens," in"]}),void 0!==s.output_tokens&&(0,r.jsxs)("span",{className:"text-secondary",children:[s.output_tokens," out"]}),null!==s.cached&&void 0!==s.cached&&(0,r.jsx)(v,{variant:s.cached?"secondary":"info",children:s.cached?"CACHED":"FRESH"}),(0,r.jsx)("span",{className:"text-secondary",children:x(s.duration_ms||0)}),(0,r.jsx)(v,{variant:{running:"warning",completed:"success",error:"error"}[l]||"success",children:l}),(0,r.jsx)("span",{className:"text-secondary",children:a?"‚ñº":"‚ñ∂"})]})]}),a&&(0,r.jsxs)("div",{className:"px-4 py-3 bg-background border-t border-surface-hover space-y-3",children:[s.system_prompt&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"System Prompt"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:s.system_prompt})]}),null!=s.input_messages&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Input Messages"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:i(s.input_messages)})]}),s.output_content&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Output"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:"string"==typeof s.output_content?s.output_content:JSON.stringify(s.output_content,null,2)})]}),null!=s.tool_input&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Tool Input"}),(0,r.jsx)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:i(s.tool_input)})]}),s.tool_output&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-secondary uppercase mb-1",children:"Tool Output"}),(0,r.jsxs)("pre",{className:"text-sm bg-surface p-3 rounded overflow-x-auto max-h-48 whitespace-pre-wrap",children:["string"==typeof s.tool_output?s.tool_output.slice(0,2e3):JSON.stringify(s.tool_output,null,2).slice(0,2e3),"string"==typeof s.tool_output&&s.tool_output.length>2e3&&"..."]})]}),s.error&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-error uppercase mb-1",children:"Error"}),(0,r.jsx)("pre",{className:"text-sm bg-error/10 text-error p-3 rounded overflow-x-auto whitespace-pre-wrap",children:s.error})]})]})]})}function U(e){let{spans:s}=e;if(!s||0===s.length)return(0,r.jsx)("div",{className:"text-secondary text-sm py-4",children:"No spans recorded"});let t=s.filter(P),a=s.filter(e=>!P(e));return(0,r.jsxs)("div",{className:"space-y-4",children:[t.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-secondary mb-2",children:["Activity Timeline (",t.length," events)"]}),(0,r.jsx)("div",{className:"bg-surface rounded-lg p-3 space-y-0",children:t.map((e,s)=>(0,r.jsx)(L,{span:e},e.id||e.span_id||s))})]}),a.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-secondary mb-2",children:["Trace Details (",a.length," spans)"]}),(0,r.jsx)("div",{className:"space-y-2",children:a.map((e,s)=>(0,r.jsx)(R,{span:e,index:s},e.id||e.span_id||s))})]})]})}function F(){var e,s,t,a,n,c,i,o,d,m;let{selectedTrace:p,selectedTraceId:h,isLoading:g}=l();if(!h)return(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-secondary",children:(0,r.jsx)("p",{children:"Select a trace to view details"})});if(g&&!p)return(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-secondary",children:(0,r.jsx)("p",{children:"Loading trace details..."})});if(!p)return(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-error",children:(0,r.jsx)("p",{children:"Trace not found"})});let f="completed"===p.status?"success":"error"===p.status?"error":"warning",j=(null===(e=p.spans)||void 0===e?void 0:e.filter(e=>"running"===e.status))||[],y=(null===(s=p.spans)||void 0===s?void 0:s.filter(e=>"completed"===e.status))||[],b=(null===(t=p.spans)||void 0===t?void 0:t.filter(e=>"completed"===e.status&&"tool_call"===e.span_type&&e.tool_output))||[],N=(null===(a=p.spans)||void 0===a?void 0:a.length)||0,w=e=>{if(!e)return"";if("string"==typeof e)return e.slice(0,1e3)+(e.length>1e3?"...":"");try{let s=JSON.stringify(e,null,2);return s.slice(0,1e3)+(s.length>1e3?"...":"")}catch(s){return String(e).slice(0,1e3)}};return(0,r.jsxs)("div",{className:"h-full overflow-y-auto p-4",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)(v,{variant:f,children:p.status}),(0,r.jsx)("span",{className:"text-xs text-secondary font-mono cursor-pointer hover:text-primary",onClick:()=>navigator.clipboard.writeText(p.id),title:"Click to copy",children:p.id})]}),(0,r.jsx)("h2",{className:"text-lg font-semibold mb-2",children:p.input_prompt}),(0,r.jsxs)("div",{className:"flex gap-4 text-sm text-secondary",children:[(0,r.jsxs)("span",{children:["Started: ",u(p.started_at)]}),p.total_duration_ms>0&&(0,r.jsxs)("span",{children:["Duration: ",x(p.total_duration_ms)]}),p.total_tokens>0&&(0,r.jsxs)("span",{children:["Tokens: ",p.total_tokens]})]})]}),p.operational_summary&&(0,r.jsxs)("details",{className:"mb-6",children:[(0,r.jsxs)("summary",{className:"text-sm font-medium text-secondary cursor-pointer hover:text-primary flex items-center gap-2",children:[(0,r.jsx)("span",{children:"Operational Summary"}),(null===(n=p.operational_summary.errors)||void 0===n?void 0:n.length)>0&&(0,r.jsxs)(v,{variant:"error",children:[p.operational_summary.errors.length," errors"]}),(null===(c=p.operational_summary.warnings)||void 0===c?void 0:c.length)>0&&(0,r.jsxs)(v,{variant:"warning",children:[p.operational_summary.warnings.length," warnings"]})]}),(0,r.jsxs)("div",{className:"mt-3 bg-surface rounded-lg p-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-medium text-secondary uppercase mb-2",children:"Searches"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-primary",children:p.operational_summary.google_searches||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Google Searches"})]}),(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-success",children:p.operational_summary.google_searches_cached||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Google (Cached)"})]}),(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-primary",children:p.operational_summary.zap_searches||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Zap Searches"})]}),(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-success",children:p.operational_summary.zap_searches_cached||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Zap (Cached)"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-medium text-secondary uppercase mb-2",children:"Page Scrapes"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-primary",children:p.operational_summary.page_scrapes||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Pages Scraped"})]}),(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-success",children:p.operational_summary.page_scrapes_cached||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Cached"})]})]})]}),(p.operational_summary.prices_extracted>0||p.operational_summary.prices_failed>0)&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-medium text-secondary uppercase mb-2",children:"Extractions"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-success",children:p.operational_summary.prices_extracted||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Prices Found"})]}),(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-error",children:p.operational_summary.prices_failed||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Prices Failed"})]}),(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-success",children:p.operational_summary.contacts_extracted||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Contacts Found"})]}),(0,r.jsxs)("div",{className:"bg-background rounded p-2",children:[(0,r.jsx)("div",{className:"text-lg font-semibold text-error",children:p.operational_summary.contacts_failed||0}),(0,r.jsx)("div",{className:"text-xs text-secondary",children:"Contacts Failed"})]})]})]}),(null===(i=p.operational_summary.errors)||void 0===i?void 0:i.length)>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-xs font-medium text-error uppercase mb-2",children:["Errors (",p.operational_summary.errors.length,")"]}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:p.operational_summary.errors.map((e,s)=>(0,r.jsx)("div",{className:"bg-error/10 text-error text-xs p-2 rounded font-mono",children:e},s))})]}),(null===(o=p.operational_summary.warnings)||void 0===o?void 0:o.length)>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-xs font-medium text-warning uppercase mb-2",children:["Warnings (",p.operational_summary.warnings.length,")"]}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:p.operational_summary.warnings.map((e,s)=>(0,r.jsx)("div",{className:"bg-warning/10 text-warning text-xs p-2 rounded font-mono",children:e},s))})]})]})]}),"running"===p.status&&(0,r.jsxs)("div",{className:"mb-6 p-4 bg-warning/10 border border-warning/30 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-warning border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-warning font-medium",children:"Search in progress..."})]}),j.length>0&&(0,r.jsxs)("div",{className:"text-sm text-secondary",children:[(0,r.jsxs)("p",{children:["Current: ",(null===(d=j[0])||void 0===d?void 0:d.name)||"Processing"]}),(null===(m=j[0])||void 0===m?void 0:m.tool_input)!=null&&"object"==typeof j[0].tool_input&&(0,r.jsxs)("p",{className:"text-xs mt-1",children:[JSON.stringify(j[0].tool_input).slice(0,100),"..."]})]}),N>0&&(0,r.jsxs)("div",{className:"mt-2 text-xs text-secondary",children:["Steps completed: ",y.length," / ",N]}),b.length>0&&(0,r.jsxs)("div",{className:"mt-4 border-t border-warning/20 pt-3",children:[(0,r.jsx)("p",{className:"text-xs text-secondary mb-2",children:"Results so far:"}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:b.map(e=>(0,r.jsxs)("div",{className:"bg-background/50 rounded p-2 text-xs",children:[(0,r.jsx)("p",{className:"text-primary font-medium mb-1",children:e.name}),(0,r.jsx)("pre",{className:"text-secondary whitespace-pre-wrap font-mono text-[10px] max-h-32 overflow-y-auto",children:w(e.tool_output)})]},e.id))})]})]}),p.error&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-error mb-2",children:"Error"}),(0,r.jsx)("div",{className:"bg-error/10 border border-error/30 rounded-lg p-4 text-sm text-error",children:p.error})]}),(0,r.jsx)(O,{}),p.spans&&p.spans.length>0&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(U,{spans:p.spans})}),p.final_output&&(0,r.jsxs)("details",{className:"mb-6",children:[(0,r.jsx)("summary",{className:"text-sm font-medium text-secondary mb-2 cursor-pointer hover:text-primary",children:"Raw Output"}),(0,r.jsx)("div",{className:"bg-background rounded-lg p-4 text-sm whitespace-pre-wrap mt-2",children:p.final_output})]})]})}function M(){let{query:e,setQuery:s,isSearching:t,runSearch:a}=N(),[n,c]=(0,f.useState)(e);return(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n.trim()&&(s(n),a(n))},className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value),placeholder:"Search for products (e.g., iPhone 15, Samsung TV...)",className:"flex-1 px-4 py-2 bg-surface border border-surface-hover rounded-lg text-white placeholder-secondary focus:outline-none focus:border-primary",disabled:t}),(0,r.jsx)(D,{type:"submit",disabled:t||!n.trim(),children:t?"Searching...":"Search"})]})}function W(e){let{isOpen:s,onClose:t,title:a,children:n,footer:c,className:l}=e;return((0,f.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return s&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[s,t]),s)?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:t,children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/70"}),(0,r.jsxs)("div",{className:d("relative bg-surface rounded-xl max-w-2xl w-[90%] max-h-[80vh] overflow-hidden","shadow-2xl",l),onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-surface-hover",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:a}),(0,r.jsx)("button",{onClick:t,className:"text-secondary hover:text-white text-2xl leading-none",children:"\xd7"})]}),(0,r.jsx)("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:n}),c&&(0,r.jsx)("div",{className:"flex justify-end gap-3 px-5 py-4 border-t border-surface-hover",children:c})]})]}):null}function A(){let{isModalOpen:e,closeModal:s,drafts:t,sentIndices:a,updateDraftMessage:n,updateDraftPhone:c,markAsSent:l,isGenerating:i,error:o}=w(),u=e=>{let s=t[e];window.open(s.wa_link,"_blank"),l(e)},x=async e=>{let s=t[e];await navigator.clipboard.writeText(s.wa_link)};return(0,r.jsx)(W,{isOpen:e,onClose:s,title:"Review Negotiation Messages",footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D,{variant:"success",onClick:()=>{t.forEach((e,s)=>{a.has(s)||setTimeout(()=>u(s),500*s)})},children:"Send All via WhatsApp"}),(0,r.jsx)(D,{variant:"secondary",onClick:s,children:"Cancel"})]}),children:i?(0,r.jsx)("p",{className:"text-secondary text-center py-8",children:"Generating drafts..."}):o?(0,r.jsx)("p",{className:"text-error text-center py-8",children:o}):(0,r.jsx)("div",{className:"space-y-4",children:t.map((e,s)=>(0,r.jsxs)("div",{className:d("bg-background rounded-lg p-4",a.has(s)&&"opacity-60 border-2 border-success"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:!0,readOnly:!0,className:"w-4 h-4"}),(0,r.jsx)("strong",{className:"text-primary",children:e.seller_name})]}),(0,r.jsxs)("p",{className:"text-sm text-secondary mb-3",children:["Product: ",e.product_name]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-xs text-secondary mb-1",children:"Phone Number:"}),(0,r.jsx)("input",{type:"text",value:e.phone_number,onChange:e=>c(s,e.target.value),className:"w-48 px-3 py-1.5 bg-surface border border-surface-hover rounded text-white text-sm focus:outline-none focus:border-primary"})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-xs text-secondary mb-1",children:"Message:"}),(0,r.jsx)("textarea",{value:e.message,onChange:e=>n(s,e.target.value),className:"w-full min-h-[80px] px-3 py-2 bg-surface border border-surface-hover rounded text-white text-sm resize-y focus:outline-none focus:border-primary"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(D,{variant:"success",size:"sm",onClick:()=>u(s),disabled:a.has(s),children:a.has(s)?"‚úì Opened":"\uD83D\uDCF1 Send via WhatsApp"}),(0,r.jsx)(D,{variant:"secondary",size:"sm",onClick:()=>x(s),children:"\uD83D\uDD17 Copy Link"})]})]},s))})})}function J(){return!function(){let e=(0,f.useRef)(null),s=(0,f.useRef)(),{setConnectionStatus:t,addTrace:r,updateTrace:a,fetchTraces:n,fetchTraceDetail:c,selectedTraceId:i}=l(),o=(0,f.useCallback)(e=>{let s=e.data||{};switch(e.event_type){case"trace_started":r({id:e.trace_id,input_prompt:s.input_prompt||"",status:"running",started_at:s.started_at||new Date().toISOString(),total_tokens:0,total_duration_ms:0,spans:[],operational_summary:s.operational_summary});break;case"trace_ended":a(e.trace_id,{status:s.error?"error":"completed",final_output:s.final_output,error:s.error,ended_at:s.ended_at||new Date().toISOString(),total_duration_ms:s.total_duration_ms,total_tokens:s.total_tokens,operational_summary:s.operational_summary});break;case"span_started":case"span_ended":n(),i&&e.trace_id===i&&c(i);break;default:console.log("Unknown event:",e.event_type)}},[r,a,n,c,i]),d=(0,f.useCallback)(()=>{t("connecting");let r=function(){{let e="https:"===window.location.protocol?"wss:":"ws:";return"".concat(e,"//").concat(window.location.host)}}(),a=new WebSocket("".concat(r,"/traces/ws"));e.current=a,a.onopen=()=>{console.log("WebSocket connected"),t("connected")},a.onclose=()=>{console.log("WebSocket disconnected"),t("disconnected"),s.current=setTimeout(d,3e3)},a.onerror=e=>{console.error("WebSocket error:",e),t("disconnected")},a.onmessage=e=>{try{let s=JSON.parse(e.data);o(s)}catch(e){console.error("Failed to parse WebSocket message:",e)}}},[t,o]);(0,f.useEffect)(()=>(d(),()=>{e.current&&e.current.close(),s.current&&clearTimeout(s.current)}),[d]),e.current}(),(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-background",children:[(0,r.jsx)(g,{}),(0,r.jsxs)("main",{className:"flex-1 flex flex-col p-4 gap-4",children:[(0,r.jsx)("section",{className:"bg-surface rounded-lg p-4",children:(0,r.jsx)(M,{})}),(0,r.jsxs)("div",{className:"flex-1 flex gap-4 min-h-0",children:[(0,r.jsxs)("aside",{className:"w-80 bg-surface rounded-lg overflow-hidden flex flex-col",children:[(0,r.jsx)("div",{className:"px-4 py-3 border-b border-surface-hover",children:(0,r.jsx)("h2",{className:"font-medium",children:"Recent Traces"})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,r.jsx)(b,{})})]}),(0,r.jsx)("section",{className:"flex-1 bg-surface rounded-lg overflow-hidden",children:(0,r.jsx)(F,{})})]})]}),(0,r.jsx)(A,{})]})}D.displayName="Button"},1837:function(e,s,t){"use strict";t.d(s,{h:function(){return a}});class r{async fetch(e,s){let t=await fetch("".concat(this.baseUrl).concat(e),{...s,headers:{"Content-Type":"application/json",...null==s?void 0:s.headers}});if(!t.ok)throw Error("API error: ".concat(t.status," ").concat(t.statusText));return t.json()}async getTraces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return(await this.fetch("/traces/?limit=".concat(e))).traces}async getTrace(e){return this.fetch("/traces/".concat(e))}async deleteTrace(e){await this.fetch("/traces/".concat(e),{method:"DELETE"})}async runQuery(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"research";return this.fetch("/agent/run",{method:"POST",body:JSON.stringify({query:e,agent:s})})}async generateDrafts(e){return this.fetch("/agent/generate-drafts",{method:"POST",body:JSON.stringify(e)})}async lookupContacts(e){return(await this.fetch("/api/sellers/contacts",{method:"POST",body:JSON.stringify({domains:e})})).contacts}async getSellers(){return(await this.fetch("/api/sellers/")).sellers}constructor(e="http://localhost:8000"){this.baseUrl=e}}let a=new r}},function(e){e.O(0,[972,163,971,117,744],function(){return e(e.s=710)}),_N_E=e.O()}]);